<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>
<!-- otrs.github.io -->
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../../../../documentation.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../../../../documentation.js"></script>
<link rel="icon" type="image/png" sizes="32x32" href="../../../../../../../../images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../../../../../../images/favicon-16x16.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script>
$(document).ready(function() {

    // Hint languages to prevent false matches (php for example).
    hljs.configure({
        languages: ['perl', 'javascript', 'xml', 'html', 'css', 'json', 'yaml']
    });

    // programlistings in manuals
    $('pre.programlisting').each(function(i, block) {
        hljs.highlightBlock(block);
    });
    // code snippets in Perl API docs
    $('.pod pre').addClass('perl').each(function(i, block) {
        hljs.highlightBlock(block);
    });
});</script>
<!-- otrs.github.io -->

<title>Kernel::System::DocumentSearch::BaseDriver &mdash; OTRS 9.0 API Reference Perl</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body><div class="box">
  <h1 class="t1">OTRS 9.0 API Reference Perl</h1>
  <table>
    <tr>
      <td class="label">Description</td>
      <td class="cell">manuals and libraries</td>
    </tr>
  </table>
</div>
<div class="path">
  <a href="../../../index.html">OTRS 9.0 API Reference Perl</a> &gt; Perl Modules &gt;
  Kernel::System::DocumentSearch::BaseDriver
</div>
<div>

</div>

<div class="pod">


<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#PUBLIC-INTERFACE">PUBLIC INTERFACE</a>
    <ul>
      <li><a href="#has-IndexName">has IndexName</a></li>
      <li><a href="#has-DocumentType">has DocumentType</a></li>
      <li><a href="#has-DocumentTypeLabel">has DocumentTypeLabel</a></li>
      <li><a href="#has-DocumentIDName">has DocumentIDName</a></li>
      <li><a href="#has-DocumentTitle">has DocumentTitle</a></li>
      <li><a href="#has-AgentAccess">has AgentAccess</a></li>
      <li><a href="#has-CustomerAccess">has CustomerAccess</a></li>
      <li><a href="#has-PublicAccess">has PublicAccess</a></li>
      <li><a href="#has-MergeInto">has MergeInto</a></li>
      <li><a href="#has-PredefinedFiltersLookupMap">has PredefinedFiltersLookupMap</a></li>
      <li><a href="#has-CustomDrivers">has CustomDrivers</a></li>
      <li><a href="#BUILD">BUILD()</a></li>
      <li><a href="#IndexSettings">IndexSettings()</a></li>
      <li><a href="#IndexMappings">IndexMappings()</a></li>
      <li><a href="#FilterJoin">FilterJoin()</a></li>
      <li><a href="#Filter">Filter()</a></li>
      <li><a href="#DocumentPermissionMap">DocumentPermissionMap()</a></li>
      <li><a href="#DocumentList">DocumentList()</a></li>
      <li><a href="#DocumentGet">DocumentGet()</a></li>
      <li><a href="#DocumentStatus">DocumentStatus()</a></li>
      <li><a href="#SearchableSortableFieldsGet">SearchableSortableFieldsGet()</a></li>
      <li><a href="#PredefinedFiltersLookup">PredefinedFiltersLookup()</a></li>
      <li><a href="#PredefinedFilters">PredefinedFilters()</a></li>
      <li><a href="#FilterAggregations">FilterAggregations()</a></li>
      <li><a href="#UsedPipelines">UsedPipelines()</a></li>
      <li><a href="#UsedDynamicTemplates">UsedDynamicTemplates()</a></li>
    </ul>
  </li>
  <li><a href="#PRIVATE-INTERFACE">PRIVATE INTERFACE</a>
    <ul>
      <li><a href="#GetStopWords">_GetStopWords()</a></li>
      <li><a href="#GetFlatTreeList">_GetFlatTreeList()</a></li>
      <li><a href="#FlatTreeListPredefinedFiltersGet">_FlatTreeListPredefinedFiltersGet()</a></li>
      <li><a href="#PredefinedFiltersLookup1">_PredefinedFiltersLookup()</a></li>
      <li><a href="#BuildPredefinedFiltersLookupMap">_BuildPredefinedFiltersLookupMap()</a></li>
      <li><a href="#BuildCustomDrivers">_BuildCustomDrivers()</a></li>
    </ul>
  </li>
</ul>

<h1 id="NAME">NAME</h1>

<p>Kernel::System::DocumentSearch::BaseDriver - Base class for index drivers.</p>

<h1 id="PUBLIC-INTERFACE">PUBLIC INTERFACE</h1>

<p>Provides methods and attributes to store and provide index related information.</p>

<h2 id="has-IndexName">has IndexName</h2>

<p>Attribute that holds the index name to be used on the cluster.</p>

<h2 id="has-DocumentType">has DocumentType</h2>

<p>Attribute that holds the document type, that is used to identify the driver and index.</p>

<h2 id="has-DocumentTypeLabel">has DocumentTypeLabel</h2>

<p>Attribute that holds the human readable label of the <code>DocumentType</code>.</p>

<h2 id="has-DocumentIDName">has DocumentIDName</h2>

<p>Attribute that holds the name of the <code>DocumentID</code>, to identify what real field is used as the identifier.</p>

<h2 id="has-DocumentTitle">has DocumentTitle</h2>

<p>Attribute that holds the field name of the title field to be implicitly included in search results.</p>

<h2 id="has-AgentAccess">has AgentAccess</h2>

<p>Attribute that defines if the document type is accessible by agent search queries.</p>

<h2 id="has-CustomerAccess">has CustomerAccess</h2>

<p>Attribute that defines if the document type is accessible by customer search queries.</p>

<h2 id="has-PublicAccess">has PublicAccess</h2>

<p>Attribute that defines if the document type is accessible by public search queries.</p>

<h2 id="has-MergeInto">has MergeInto</h2>

<p>Attribute that defines if the document is merged into other.</p>

<h2 id="has-PredefinedFiltersLookupMap">has PredefinedFiltersLookupMap</h2>

<p>Attribute that holds the value mapping for the PredefinedFiltersLookup.</p>

<h2 id="has-CustomDrivers">has CustomDrivers</h2>

<p>Attribute that holds the custom index driver objects. The index driver modules are located below <code>Kernel::System::DocumentSearch::CustomDriver::*</code>, please refer to the single modules for more information.</p>

<h2 id="BUILD">BUILD()</h2>

<p>During the <code>instantiation</code> of the object, it will be checked, if a configuration option <code>DocumentSearch::IndexPrefix</code> is available, that is used to add an index prefix to every index name. This provides the possibility to use multiple OTRS instances with the same Elasticsearch cluster.</p>

<h2 id="IndexSettings">IndexSettings()</h2>

<p>This method provides the index settings to be used for the related index. At first it searches for related settings inside the configuration, based on the <code>DocumentType</code> and uses the driver internal settings as a fall-back.</p>

<pre><code>    my $IndexMappings = $IndexDriver-&gt;IndexSettings();</code></pre>

<p>Returns a hash reference including the index settings.</p>

<h2 id="IndexMappings">IndexMappings()</h2>

<p>This method provides the index field mappings to be used for the related index.</p>

<pre><code>    my $IndexMappings = $IndexDriver-&gt;IndexMappings();</code></pre>

<p>Returns a hash reference including the field mapping definitions.</p>

<h2 id="FilterJoin">FilterJoin()</h2>

<p>This method provides join statements to other DocumentTypes (indices), with permission checks for queries, that affects the own query results.</p>

<pre><code>    my $FilterJoin = $IndexDriver-&gt;FilterJoin();</code></pre>

<p>Returns a hash reference including the filter join information.</p>

<h2 id="Filter">Filter()</h2>

<p>This method provides filter statements, based on agent and customer information.</p>

<pre><code>    my $Filter = $IndexDriver-&gt;Filter();</code></pre>

<p>Returns a hash reference including the filter queries.</p>

<h2 id="DocumentPermissionMap">DocumentPermissionMap()</h2>

<p>This method provides a map for permission fields in local documents. Those permissions are used to automatically generate query filter entries, that limits the access to documents.</p>

<p>Possible map keys are &#39;GroupID&#39;, &#39;UserID&#39;, &#39;CustomerUserID&#39; and &#39;CustomerID&#39;. The values may be either field names as strings or arrays of field names.</p>

<pre><code>    my $Permission = $IndexDriver-&gt;DocumentPermissionMap();</code></pre>

<p>Returns:</p>

<pre><code>    {
        GroupID        =&gt; &#39;GroupID&#39;,
        UserID         =&gt; [ &#39;OwnerID&#39;, &#39;ResponsibleID&#39; ],
        CustomerUserID =&gt; &#39;CustomerUserID&#39;,
        CustomerID     =&gt; &#39;CustomerID&#39;,
    }</code></pre>

<h2 id="DocumentList">DocumentList()</h2>

<p>The list of document id&#39;s that still needs to be indexed or that are marked for re-indexing.</p>

<pre><code>    my $DocumentList = $IndexDriver-&gt;DocumentList();</code></pre>

<p>Returns</p>

<pre><code>    - an array reference, containing the document id&#39;s that needs to be indexed or updated.</code></pre>

<h2 id="DocumentGet">DocumentGet()</h2>

<p>Get the real document data for a list of <code>DocumentIDs</code> to be displayed or indexed.</p>

<pre><code>    my $DocumentData = $IndexDriver-&gt;DocumentGet();</code></pre>

<p>Returns</p>

<pre><code>    - an array reference, containing the document id&#39;s that needs to be indexed or updated.</code></pre>

<h2 id="DocumentStatus">DocumentStatus()</h2>

<p>The amount of indexed an generally available documents.</p>

<pre><code>    my $DocumentStatus = $IndexDriver-&gt;DocumentStatus();</code></pre>

<p>Returns</p>

<pre><code>    - a hash reference, containing the amount of indexed an generally available documents.</code></pre>

<h2 id="SearchableSortableFieldsGet">SearchableSortableFieldsGet()</h2>

<p>This method is used to gather the searchable and <code>sortable</code> fields for the current index driver.</p>

<pre><code>    my $Result = $IndexDriver-&gt;SearchableSortableFieldsGet();</code></pre>

<p>Returns a hash reference including the searchable and <code>sortable</code> fields.</p>

<h2 id="PredefinedFiltersLookup">PredefinedFiltersLookup()</h2>

<p>Provides the related filter structures for a filter identifier, that can either be used for real query filtering or inside filter/filters aggregations.</p>

<pre><code>    my $Filter = $IndexDriver-&gt;PredefinedFiltersLookup(
        Identifier =&gt; &#39;MyFilterIdentifier&#39;,
    )</code></pre>

<p>Returns</p>

<pre><code>    - a hash reference, containing the related filter structure of the given identifier.</code></pre>

<h2 id="PredefinedFilters">PredefinedFilters()</h2>

<p>Provides the possible pre defined filters, of the related index driver, which contain identifiers and human readable labels for the filters, to be displayed in frontends.</p>

<p>Returns</p>

<pre><code>    - an array reference, containing the pre defined filters.</code></pre>

<h2 id="FilterAggregations">FilterAggregations()</h2>

<p>Converts all pre defined filters, that are probably available in the current document type, to a related filters aggregation structure, that can be used to count the possible results, that would be returned, if such filters were used.</p>

<p>The document counts for the different pre defined filters, relates on the query string, as well as the related filters, that are applied by the caller (<code>CustomFilters</code>), the permission handling, filter joins and/or filters, that are automatically applied by the related index driver.</p>

<p>For more information about the filters aggregation, please refer to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-filters-aggregation.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-filters-aggregation.html</a>.</p>

<p>Returns</p>

<pre><code>    - a hash reference, containing the named filter entries for the filters aggregation.</code></pre>

<h2 id="UsedPipelines">UsedPipelines()</h2>

<p>This method provides a list of pipelines used by the driver</p>

<pre><code>    my $UsedPipelines = $IndexDriver-&gt;UsedPipelines();</code></pre>

<p>Returns an array reference with the name of all used pipelines.</p>

<h2 id="UsedDynamicTemplates">UsedDynamicTemplates()</h2>

<p>This method provides a list of dynamic templates used by the index driver</p>

<p>The dynamic template definitions are used to set mappings to dynamically created fields (i.e. in fields of type object).</p>

<p>For more information about dynamic templates and it&#39;s usage, please refer to <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-templates.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-templates.html</a>.</p>

<pre><code>    my $UsedDynamicTemplates = $IndexDriver-&gt;UsedDynamicTemplates();</code></pre>

<p>Returns an array reference with the name of all used dynamic templates.</p>

<h1 id="PRIVATE-INTERFACE">PRIVATE INTERFACE</h1>

<h2 id="GetStopWords">_GetStopWords()</h2>

<p>This method is used to gather all stop words, that are stored in the OTRS system configuration. Those stop words can be used for the index settings, to provide them during the indexing process.</p>

<pre><code>    my $StopWords = $IndexDriver-&gt;_GetStopWords();</code></pre>

<p>Returns an array reference with all stop words.</p>

<h2 id="GetFlatTreeList">_GetFlatTreeList()</h2>

<p>This helper method is used to convert a simple key value list with ancestors in the value e.g. Grandparent::Parent::Son into a two level tree.</p>

<pre><code>    my $FlatTreeList = $IndexDriver-&gt;_GetFlatTreeList(
        List =&gt; {
            1 =&gt; &#39;GrandFatherA&#39;,
            2 =&gt; &#39;GrandFatherB&#39;,
            3 =&gt; &#39;GrandFatherA::FatherA&#39;,
            4 =&gt; &#39;GrandFatherB::FatherB&#39;,
            5 =&gt; &#39;GrandFatherB::FatherB::SonA&#39;,
            6 =&gt; &#39;GrandFatherB::FatherB::SonB&#39;,
        },
    );

    $FlatTreeList = {
        0 =&gt; {
            1 =&gt; &#39;GrandFatherA&#39;,
            2 =&gt; &#39;GrandFatherB&#39;,
        },
        1 =&gt; {
            3 =&gt; &#39;FatherA&#39;,
        },
        2 =&gt; {
            4 =&gt; &#39;FatherB&#39;,
        },
        4 =&gt; {
            5 =&gt; &#39;SonA&#39;,
            6 =&gt; &#39;SonB&#39;,
        },
    };</code></pre>

<h2 id="FlatTreeListPredefinedFiltersGet">_FlatTreeListPredefinedFiltersGet()</h2>

<p>This helper method is used to convert a FlatTreeList into a hierarchical filter to be used in searches</p>

<pre><code>    my $PredefinedFilter = $IndexDriver-&gt;_GetFlatTreeList(
        FlatTreeList = {
            0 =&gt; {
                1 =&gt; &#39;GrandFatherA&#39;,
                2 =&gt; &#39;GrandFatherB&#39;,
            },
            1 =&gt; {
                3 =&gt; &#39;FatherA&#39;,
            },
            2 =&gt; {
                4 =&gt; &#39;FatherB&#39;,
            },
            4 =&gt; {
                5 =&gt; &#39;SonA&#39;,
                6 =&gt; &#39;SonB&#39;,
            },
        },
        ObjectList =&gt; {
            1 =&gt; &#39;GrandFatherA&#39;,
            2 =&gt; &#39;GrandFatherB&#39;,
            3 =&gt; &#39;GrandFatherA::FatherA&#39;,
            4 =&gt; &#39;GrandFatherB::FatherB&#39;,
            5 =&gt; &#39;GrandFatherB::FatherB::SonA&#39;,
            6 =&gt; &#39;GrandFatherB::FatherB::SonB&#39;,
        },
        ParentID       =&gt; 0,
        BaseIdentifier =&gt; &#39;SomeObjectID&#39;
    );</code></pre>

<p>Returns:</p>

<pre><code>    $PredefinedFilter = [
        {
            Label      =&gt; &#39;GrandFatherA&#39;,
            Identifier =&gt; &#39;SomeObjectID1&#39;,
            Filters    =&gt; [
                {
                    Label      =&gt; &#39;FatherA&#39;,
                    Identifier =&gt; &#39;SomeObjectID3&#39;,
                },
            ],
        },
        {
            Label      =&gt; &#39;GrandFatherB&#39;,
            Identifier =&gt; &#39;SomeObjectID2&#39;,
            Filters    =&gt; [
                {
                    Label      =&gt; &#39;FatherB&#39;,
                    Identifier =&gt; &#39;SomeObjectID4&#39;,
                    Filters    =&gt; [
                        {
                            Label      =&gt; &#39;SonA&#39;,
                            Identifier =&gt; &#39;SomeObjectID5&#39;,
                        },
                        {
                            Label      =&gt; &#39;SonB&#39;,
                            Identifier =&gt; &#39;SomeObjectIDB&#39;,
                        },
                    ],
                },
            ],
        },
    ];</code></pre>

<h2 id="PredefinedFiltersLookup1">_PredefinedFiltersLookup()</h2>

<p>This helper method is used to get the search term for a filter identifier</p>

<pre><code>    my $FilterTerm = $IndexDriver-&gt;_PredefinedFiltersLookup(
        Identifier =&gt; &#39;SomeIdentifier1&#39;,
    );</code></pre>

<p>Returns:</p>

<pre><code>    $FilterTerm = {
        bool =&gt; {
            must =&gt; [
                {
                    &#39;term&#39; =&gt; {
                        SomeIdentifier =&gt; &#39;1&#39;,
                    },
                },
            ],
        },
    };</code></pre>

<h2 id="BuildPredefinedFiltersLookupMap">_BuildPredefinedFiltersLookupMap()</h2>

<p>This helper method is used to get the search term for a filter identifier</p>

<pre><code>    my $FilterMapping = $IndexDriver-&gt;_BuildPredefinedFiltersLookupMap()</code></pre>

<p>Returns:</p>

<pre><code>    $FilterMapping = {
        SomeIdentifier1 =&gt; {
            must =&gt; [
                {
                    &#39;term&#39; =&gt; {
                        SomeIdentifier =&gt; &#39;1&#39;,
                    },
                },
            ],
        },
        SomeIdentifier2 =&gt; {
            must =&gt; [
                {
                    &#39;term&#39; =&gt; {
                        SomeIdentifier =&gt; &#39;2&#39;,
                    },
                },
            ],
        },
    };</code></pre>

<h2 id="BuildCustomDrivers">_BuildCustomDrivers()</h2>

<p>Initializes the CustomDriver attribute. Returns the instantiated custom index driver objects, that can be used to modify index structures and configurations and information for certain <code>DocumentType</code>.</p>

</div><div class="footer">generated by <a href="http://metacpan.org/module/Pod::ProjectDocs">Pod::ProjectDocs</a></div></body></html>


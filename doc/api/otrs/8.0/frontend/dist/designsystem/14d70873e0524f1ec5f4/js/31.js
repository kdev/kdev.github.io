(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{NAoP:function(e,t,i){"use strict";var n=i("F/wX"),r=i.n(n);t.a={props:{useSystemTimezone:{type:Boolean}},computed:{systemTimezone:function(){return this.$store&&this.$store.getters.config&&this.$store.getters.config.OTRSTimeZone?this.$store.getters.config.OTRSTimeZone:"UTC"},userTimezone:function(){var e="UTC";return this.$store&&this.$store.getters&&this.$store.getters.userInfo&&this.$store.getters.userInfo.UserTimeZone?e=this.$store.getters.userInfo.UserTimeZone:this.$store&&this.$store.getters&&this.$store.getters.config&&this.$store.getters.config.UserDefaultTimeZone&&(e=this.$store.getters.config.UserDefaultTimeZone),e}},methods:{localizeTimestamp:function(e){var t=r.a.tz(e,this.systemTimezone);return this.useSystemTimezone?{date:t,timezone:this.systemTimezone}:{date:t.clone().tz(this.userTimezone),timezone:this.userTimezone}}}}},aVww:function(e,t,i){},cofK:function(e,t,i){"use strict";i.r(t);i("2Tod"),i("ABKx"),i("DbwS"),i("3DBk"),i("W1QL"),i("K/PF"),i("t91x"),i("75LO"),i("5hJT"),i("Z8gF");var n=i("OvAC"),r=i.n(n),a=(i("e2Kn"),i("9va6")),o=i("lOrp"),s=i("NAoP"),l=i("F/wX"),c=i.n(l),d=i("+Hzs"),m=(i("a9G0"),i("e8Mr")),u=i("YV4g"),p=i("ojg4"),h=(i("C53R"),i("s1fd")),f=(i("z4M5"),i("QIYq")),g=(i("5hYj"),i("zEfT"));i("0mFd");function y(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,n)}return i}var D={name:"CommonCalendar",components:{FullCalendar:d.a},mixins:[s.a],props:{calendarPlugins:{type:Array,default:function(){return["dayGridPlugin","timeGridPlugin","listPlugin","timelinePlugin"]}},additionalImportedPlugins:{type:Array,default:function(){return[]}},appointmentFetchUrl:{type:String,default:"agent/calendar/appointment/list"},additionalAppointmentListFilter:{type:String,default:function(){}},appointmentSources:{type:Object,default:function(){return{}}},ticketAppointmentConfig:{type:Object},appointmentDetailPopoverId:{type:String},resourceDetailPopoverId:{type:String},activeView:{type:String,default:"timeGridWeek"},height:{type:[Number,Function,String],default:700},aspectRatio:{type:Number},header:{type:[Object,Boolean],default:function(){return{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay timelineMonth,timelineWeek,timelineDay listMonth,listWeek,listDay"}}},headerLeft:{type:String},headerCenter:{type:String},headerRight:{type:String},editable:{type:Boolean,default:!0},selectable:{type:Boolean,default:!0},firstWeekDay:{type:Number},resourceAreaWidth:{type:String,default:"21%"},showWeekend:{type:Boolean,default:!0},businessHours:{type:[Object,Array,Boolean]},resourceList:{type:[Object,Array,Function]},resourceColumns:{type:[Array],default:function(){return[{labelText:this.$locale.translate("Name"),field:"title"}]}},resourceOrder:{type:String},additionalViews:{type:[Object]},testMode:{type:Boolean,default:!1}},data:function(){return{importedPlugins:{dayGridPlugin:p.d,timeGridPlugin:h.a,listPlugin:f.a,timelinePlugin:g.a},fixedPlugins:[m.a,u.a],timeFormat:"HH:mm",defaultViews:{dayGridMonth:{titleFormat:"MMMM YYYY",columnHeaderFormat:"dddd"},timeGridDay:{titleFormat:"D MMM YYYY #W",resources:!1},timeGridWeek:{titleFormat:"{{D} MMM} YYYY #W"},timelineMonth:{titleFormat:"MMMM YYYY",slotDuration:"24:00:00",duration:{months:1},slotLabelFormat:["D"]},timelineWeek:{titleFormat:"{{D} MMM} YYYY #W",slotDuration:"02:00:00",duration:{week:1},slotLabelFormat:["ddd, D MMM","HH"]},timelineDay:{titleFormat:"D MMM YYYY #W",slotDuration:"00:30:00",duration:{days:1},slotLabelFormat:["ddd, D MMM","HH:mm"]},listDay:{titleFormat:"D MMM YYYY #W"},listWeek:{titleFormat:"{{D} MMM} YYYY #W"},listMonth:{titleFormat:"MMMM YYYY"}},localViews:{},defaultView:this.activeView,localActiveView:this.activeView,appointmentList:[],renderedAppointments:{},testData:[{id:1,title:"A example appointment",allDay:!0,start:c()().format("Y-MM-DD"),end:c()().add(1,"day").format("Y-MM-DD"),textColor:"#FFFFFF"},{id:1,title:"Additional appointment",start:c()().format("Y-MM-DD HH:mm:ss"),end:c()().add(2,"hour").format("Y-MM-DD HH:mm:ss"),textColor:"#FFFFFF"}],isLoading:!1,resourceSliderEventRegistered:!1}},computed:function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?y(Object(i),!0).forEach(function(t){r()(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}({},Object(o.b)(["language","config","userInfo"]),{languageLocale:function(){return c.a.locale(this.language.toLowerCase().replace("_","-"))},fullCalendarApi:function(){if(this.$refs.fullCalendar)return this.$refs.fullCalendar.getApi()},fullCalendarPlugins:function(){var e=this,t=this.fixedPlugins||[];return this.calendarPlugins.forEach(function(i){e.importedPlugins[i]&&t.push(e.importedPlugins[i])}),this.additionalImportedPlugins&&this.additionalImportedPlugins.length>0&&this.additionalImportedPlugins.forEach(function(e){t.push(e)}),t},localHeight:function(){if("string"!=typeof this.height||"calcByAspectRatio"!==this.height)return this.height},localHeader:function(){var e=this,t=Object(a.cloneDeep)(this.header),i={headerLeft:"left",headerCenter:"center",headerRight:"right"};return["headerLeft","headerCenter","headerRight"].forEach(function(n){e[n]&&(t[i[n]]=e[n])}),t},buttonText:function(){return{today:this.$locale.translate("Today"),month:this.$locale.translate("Grid Month"),week:this.$locale.translate("Grid Week"),day:this.$locale.translate("Grid Day"),timelineCustom:this.$locale.translate("Timeline %s",this.getButtonText("timelineCustom")),timelineMonth:this.$locale.translate("Timeline Month"),timelineWeek:this.$locale.translate("Timeline Week"),timelineDay:this.$locale.translate("Timeline Day"),resourceTimelineCustom:this.$locale.translate("Timeline %s",this.getButtonText("resourceTimelineCustom")),resourceTimelineMonth:this.$locale.translate("Timeline Month"),resourceTimelineWeek:this.$locale.translate("Timeline Week"),resourceTimelineDay:this.$locale.translate("Timeline Day"),listYear:this.$locale.translate("Agenda Year"),listMonth:this.$locale.translate("Agenda Month"),listWeek:this.$locale.translate("Agenda Week"),listDay:this.$locale.translate("Agenda Day"),prev:this.$locale.translate("Previous"),next:this.$locale.translate("Next")}},finalViews:function(){return Object.assign(this.localViews||{},this.defaultViews||{},this.additionalViews||{})},calendarIds:function(){return Object.keys(this.appointmentSources)||[]},calendarDynamicFields:function(){var e=[];return Object.values(this.appointmentSources).forEach(function(t){t.DynamicFields&&(e=e.concat(t.DynamicFields))}),e}}),watch:{calendarIds:function(e,t){Object(a.isEqual)(e,t)||this.refetchAppointments()},activeView:function(e,t){e!==this.localActiveView&&e!==t&&(this.defaultView=e,this.localActiveView=e)}},methods:{refetchAppointments:function(){this.fullCalendarApi.refetchEvents()},changeView:function(e){this.fullCalendarApi.changeView(e)},updateSize:function(){this.fullCalendarApi.updateSize()},onViewChange:function(e){var t=e.view.type;this.resetRenderedAppoinments(),t!==this.localActiveView&&(this.localActiveView=t,this.$emit("view-changed",t),this.resourceSliderEventRegistered=!1)},resetRenderedAppoinments:function(){this.renderedAppointments={}},onAddEventSelect:function(e){var t=c.a.tz(e.start.toISOString().slice(0,-1),this.userTimezone),i=c.a.tz(e.end.toISOString().slice(0,-1),this.userTimezone),n={allDay:e.allDay};"timelineMonth"!==this.activeView&&"resourceTimelineMonth"!==this.activeView||(n.allDay=!0),n.allDay||(t=t.clone().tz(this.systemTimezone),i=i.clone().tz(this.systemTimezone)),n.startTime=t.format("Y-MM-DD HH:mm:ss"),n.endTime=i.format("Y-MM-DD HH:mm:ss"),e.resource&&(n.resourceId=[e.resource.id]),this.$emit("add-appointment-select",n)},eventRender:function(e){var t=this.transformEventData(e.event),i=e.view.type;if(Object.prototype.hasOwnProperty.call(this.renderedAppointments,t.id)?this.renderedAppointments[t.id]++:this.renderedAppointments[t.id]=1,this.appointmentDetailPopoverId){var n=t.id;this.renderedAppointments[t.id]>1&&(n+="-".concat(this.renderedAppointments[t.id])),e.el.id="".concat(this.appointmentDetailPopoverId,"-").concat(n),e.el.className+=" appointment-".concat(n)}if(("timelineCustom"===i||"resourceTimelineCustom"===i)&&t.additionalTitle){var r=e.el.querySelector(".fc-title").innerHTML;e.el.querySelector(".fc-title").innerHTML="".concat(r,"<br>").concat(t.additionalTitle)}},resourceRender:function(e){var t=this,i=document.querySelector(".fc-divider");!this.resourceSliderEventRegistered&&i&&(document.querySelectorAll(".fc-divider").forEach(function(e){e.addEventListener("mouseup",function(){t.resourceSliderEventRegistered=!1,t.$emit("resize-resource-area")})}),this.resourceSliderEventRegistered=!0),this.resourceDetailPopoverId&&(e.el.querySelector("span.fc-cell-text").id="".concat(this.resourceDetailPopoverId,"-").concat(e.resource.id))},onEditEvent:function(e){var t=e.event;this.$emit("edit-appointment",t.id,this.transformEventData(t))},onEventChange:function(e){var t=e.event,i=e.oldEvent||e.prevEvent,n={},r=c.a.tz(t.start.toISOString().slice(0,-1),this.userTimezone),a=c.a.tz(t.end.toISOString().slice(0,-1),this.userTimezone);t.allDay?(a.subtract(1,"day"),t.startTime=r.format("Y-MM-DD 00:00:00"),t.endTime=a.format("Y-MM-DD 00:00:00")):(r=r.clone().tz(this.systemTimezone),a=a.clone().tz(this.systemTimezone),t.startTime=r.format("Y-MM-DD HH:mm:ss"),t.endTime=a.format("Y-MM-DD HH:mm:ss"));var o=c.a.tz(i.start.toISOString().slice(0,-1),this.userTimezone),s=c.a.tz(i.end.toISOString().slice(0,-1),this.userTimezone);i.allDay?(s.subtract(1,"day"),i.startTime=o.format("Y-MM-DD 00:00:00"),i.endTime=s.format("Y-MM-DD 00:00:00")):(o=o.clone().tz(this.systemTimezone),s=s.clone().tz(this.systemTimezone),i.startTime=o.format("Y-MM-DD HH:mm:ss"),i.endTime=s.format("Y-MM-DD HH:mm:ss")),Object.prototype.hasOwnProperty.call(e,"newResource")&&(n.oldResource=e.oldResource,n.newResource=e.newResource),this.$emit("change-appointment",e.event.id,this.transformEventData(t),this.transformEventData(i),e.revert,n)},onShowPopover:function(e){this.$emit("show-appointment-popover",e.el.id,e.event.id,this.transformEventData(e.event))},onHidePopover:function(){this.$emit("hide-appointment-popover")},onLoading:function(e){this.isLoading=e},eventHandler:function(e){var t=this;return new Promise(function(i,n){if(t.testMode)i(t.testData);else if(t.calendarIds.length){var r=c()(e.startStr).format("Y-MM-DD 00:00:00"),a=c()(e.endStr).format("Y-MM-DD 00:00:00"),o={CalendarIDs:{Value:t.calendarIds},AppointmentPeriod_DateTimeRange:{Value:{Start:r,End:a}}},s={ActiveFilters:o=Object.assign(o,t.additionalAppointmentListFilter||{}),DynamicFields:t.calendarDynamicFields,Page:0,SortBy:[{Column:"StartTime",Direction:"Up"}]};t.clientSendRequest({Path:t.appointmentFetchUrl,Method:"post",Body:s}).then(function(e){if(t.calendarIds.length){var n=[];e.Body.ItemList&&e.Body.ItemList.forEach(function(e){n.push(t.transformAppointmentData(e))}),t.$nextTick(function(){t.$test.setFlag("Calendar::AppointmentList::Fetch")}),i(n)}else i([])}).catch(function(e){t.$log.error("Loading appointment list data failed!",e),n(e)})}else i([])})},transformAppointmentData:function(e){var t,i=this.appointmentSources[e.CalendarID],n=!0,r=!0,a=!0;0===parseInt(i.Permission,10)?(n=!1,r=!1,a=!1):this.ticketAppointmentConfig&&(e.TicketAppointmentRuleStartDateType&&(n=0===parseInt(this.ticketAppointmentConfig[e.TicketAppointmentRuleStartDateType].NoDrag,10)),e.TicketAppointmentRuleEndDateType&&"Plus_"===e.TicketAppointmentRuleEndDateType.substring(0,5)?r=!1:e.TicketAppointmentRuleEndDateType&&(r=0===parseInt(this.ticketAppointmentConfig[e.TicketAppointmentRuleStartDateType].NoDrag,10))),e.TicketAppointmentRuleStartDateType&&this.ticketAppointmentConfig&&this.ticketAppointmentConfig[e.TicketAppointmentRuleStartDateType]&&(t=this.ticketAppointmentConfig[e.TicketAppointmentRuleStartDateType].Mark);var o,s,l=1===parseInt(e.AllDay,10);if(l){o=c.a.tz(e.StartTime,this.systemTimezone).format("Y-MM-DD");var d=c.a.tz(e.EndTime,this.systemTimezone);d.add(1,"day"),s=d.format("Y-MM-DD")}else o=c.a.tz(e.StartTime,this.systemTimezone),s=c.a.tz(e.EndTime,this.systemTimezone),o=o.clone().tz(this.userTimezone).format("Y-MM-DD HH:mm:ss"),s=s.clone().tz(this.userTimezone).format("Y-MM-DD HH:mm:ss");return{id:e.AppointmentID,parentId:e.ParentID,color:i.Color,textColor:i.TextColor,start:o,end:s,startTime:e.StartTime,endTime:e.EndTime,title:e.Title,description:e.Description,location:e.Location,calendarId:e.CalendarID,calendarName:i.CalendarName,calendarPermission:1===parseInt(i.Permission,10),allDay:l,recurring:1===parseInt(e.Recurring,10),recurrenceType:e.RecurrenceType,recurrenceFrequency:e.RecurrenceFrequency,teamIds:e.TeamID,teamNames:e.TeamNames,resourceIds:e.ResourceID,resourceListIds:e.ResourceID,resourceNames:e.ResourceNames,plugins:e.Plugins,notification:!!e.NotificationDate.length,notificationDate:e.NotificationDate,ticketAppointmentRuleStartDateType:e.TicketAppointmentRuleStartDateType,ticketAppointmentRuleMarker:t,startEditable:n,durationEditable:r,eventResourceEditable:a,additionalTitle:e.AdditionalTitle,dynamicFields:e.DynamicFields}},transformEventData:function(e){var t={id:e.id,title:e.title,backgroundColor:e.backgroundColor,allDay:e.allDay};return t=Object.assign(t,e.extendedProps||{}),e.startTime&&e.endTime&&(t.startTime=e.startTime,t.endTime=e.endTime),t},getButtonText:function(e){var t={1:this.$locale.translate("1 Week"),2:this.$locale.translate("2 Weeks"),4:this.$locale.translate("4 Weeks"),6:this.$locale.translate("6 Weeks")};return this.finalViews[e]?t[this.finalViews[e].duration.week]:this.$locale.translate("Custom")}}},T=(i("kr+v"),i("psIG")),v=Object(T.a)(D,function(){var e=this,t=e.$createElement;return(e._self._c||t)("FullCalendar",{key:e.localHeader.right,ref:"fullCalendar",attrs:{plugins:e.fullCalendarPlugins,events:e.eventHandler,"event-render":e.eventRender,"resource-render":e.resourceRender,"default-view":e.defaultView,locale:e.languageLocale,"time-zone":"UTC",editable:e.editable,selectable:e.selectable,height:e.localHeight,"aspect-ratio":e.aspectRatio,header:e.localHeader,"button-text":e.buttonText,"all-day-text":e._f("translate")("All-day"),dir:e.$locale.localeConfig("TextDirection")||"ltr","event-limit":!0,"event-limit-text":e._f("translate")("more"),"event-time-format":e.timeFormat,"slot-label-format":e.timeFormat,"first-day":e.firstWeekDay,"resource-area-width":e.resourceAreaWidth,weekends:e.showWeekend,views:e.finalViews,"no-events-message":e._f("translate")("No appointments to display"),"business-hours":e.businessHours,resources:e.resourceList,"resource-columns":e.resourceColumns,"resource-order":e.resourceOrder,"resource-label-text":e._f("translate")("Resources"),"column-header-format":"ddd, D MMM","title-format":"D MMM YYYY","week-numbers":!0,"week-label":"#","week-number-calculation":"ISO","slot-duration":"00:30:00","force-event-duration":!0,"now-indicator":!0,"scheduler-license-key":"GPL-My-Project-Is-Open-Source","view-skeleton-render":e.onViewChange,"dates-render":e.resetRenderedAppoinments},on:{select:e.onAddEventSelect,eventClick:e.onEditEvent,eventMouseEnter:e.onShowPopover,eventMouseLeave:e.onHidePopover,eventDrop:e.onEventChange,eventResize:e.onEventChange,loading:e.onLoading}})},[],!1,null,null,null);t.default=v.exports},"kr+v":function(e,t,i){"use strict";var n=i("aVww");i.n(n).a}}]);
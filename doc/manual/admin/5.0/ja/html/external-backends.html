<html><head>
<!-- otrs.github.io -->
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../../documentation.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../../documentation.js"></script>
<link rel="icon" type="image/png" sizes="32x32" href="../../../../../../images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../../../../images/favicon-16x16.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script>
$(document).ready(function() {

    // Hint languages to prevent false matches (php for example).
    hljs.configure({
        languages: ['perl', 'javascript', 'xml', 'html', 'css', 'json', 'yaml']
    });

    // programlistings in manuals
    $('pre.programlisting').each(function(i, block) {
        hljs.highlightBlock(block);
    });
    // code snippets in Perl API docs
    $('.pod pre').addClass('perl').each(function(i, block) {
        hljs.highlightBlock(block);
    });
});</script>
<!-- otrs.github.io -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Using External backends</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="OTRS 5 - 管理 マニュアル"><link rel="up" href="administration.html" title="第4章 管理"><link rel="prev" href="email-settings.html" title="Eメール設定"><link rel="next" href="ticket-settings.html" title="チケット設定"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Using External backends</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="email-settings.html">戻る</a> </td><th width="60%" align="center">第4章 管理</th><td width="20%" align="right"> <a accesskey="n" href="ticket-settings.html">次へ</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="external-backends"></a>Using External backends</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="external-backends.html#customer-data">Customer Data</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-user-backend">Customer User Backend</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-backend-db">データベース(デフォルト)</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#multi-customer-ids-db">Customer with Multiple IDs (Company Tickets)</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#customer-backend-ldap">LDAP</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#multi-customer-ids-ldap">Customer with Multiple IDs (Company Tickets)</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#multiple-customer-backends">Using More than One Customer Backend with OTRS</a></span></dt><dt><span class="section"><a href="external-backends.html#dynamicfield-from-customeruser">Storing CustomerUser Data in Dynamic Fields</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#auth-backends">Backends to Authenticate Agents and Customers</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#agent-auth-backends">担当者のための認証バックエンド</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#agent-auth-backend-db">DB(デフォルト)</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-ldap">LDAP</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-httpbasic">担当者のためのHTTPBasicAuth</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-radius">Radius</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#customer-auth-backends">Authentication Backends for Customers</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-auth-backend-db">データベース(デフォルト)</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-ldap">LDAP</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-httpbasic">HTTPBasicAuth for Customers</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-radius">Radius</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="external-backends.html#customer-self-registration">Customizing the Customer Self-Registration</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-self-registration-tt">Customizing the Web Interface</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-self-registration-mapping">Customer Mapping</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-self-registration-customer-table">Customizing the <code class="literal">customer_user</code> Table in the OTRS DB</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="customer-data"></a>Customer Data</h3></div></div></div><p>
OTRSは、ユーザー名、メール・アドレス、電話番号などのような多くの顧客情報属性で動作しています。これらの属性は担当者および顧客フロント・エンドの両方に表示され、顧客の認証に使用されます。
</p><p>
OTRSの内に使用されるか表示された顧客情報は高度にカスタマイズ可能です。しかし次の情報は、顧客認証に常に必要とされます:
</p><p>
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
      User login（ユーザーログイン）
    </p></li><li class="listitem"><p>
      Email address（Eメールアドレス）
    </p></li><li class="listitem"><p>
      Customer ID（顧客ID）
    </p></li></ul></div><p>
</p><p>
担当者インターフェースの顧客情報を表示したければ、次のSysConfigパラメタを使用して下さい。
</p><p>
</p><pre class="programlisting">
    # Ticket::Frontend::CustomerInfo*
    # （作成（電話とEメール）、ズーム、キュービュー時に顧客情報を表示）
    $Self-&gt;{'Ticket::Frontend::CustomerInfoCompose'} = 1;
    $Self-&gt;{'Ticket::Frontend::CustomerInfoZoom'} = 1;
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト：SysConfig構成パラメタ</em></span>
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="customer-user-backend"></a>Customer User Backend</h3></div></div></div><p>
2つのタイプの顧客バックエンド、DBおよびLDAPを使用することができます。あなたが別の顧客バックエンド(例えばSAP)を既に持っていれば、それを使用するモジュールを書くことはもちろん可能です。
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-backend-db"></a>データベース(デフォルト)</h4></div></div></div><p>
下記の例は、DB顧客バックエンドの構成を示します。それは、OTRSデータベースに保存された顧客情報を使用します。
</p><div class="example"><a name="db-customer-backend"></a><p class="title"><b>例4.7 DB顧客バックエンドの構成</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# CustomerUser (customer database backend and settings)
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'Database Datasource',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # if you want to use an external database, add the required settings
#            DSN =&gt; 'DBI:odbc:yourdsn',
#            Type =&gt; 'mssql', # only for ODBC connections
#            DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#            User =&gt; '',
#            Password =&gt; '',
            Table =&gt; 'customer_user',

            # CaseSensitive will control if the SQL statements need LOWER()
            #   function calls to work case insensitively. Setting this to
            #   1 will improve performance dramatically on large databases.
            CaseSensitive =&gt; 0,
        },
# customer unique id
CustomerKey =&gt; 'login',

# customer #
CustomerID =&gt; 'customer_id',
CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title','first_name','last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # show not own tickets in customer panel, CompanyTickets
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # generate auto logins
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # admin can change customer preferences
#    AdminSetPreferences =&gt; 1,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
#    # just a read only source
#    ReadOnly =&gt; 1,
    Map =&gt; [
        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
        [ 'UserTitle',      'Title',      'title',      1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name', 1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',  1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',      1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',         0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',      1, 1, 'var', '', 0 ],
#        [ 'UserEmail',      Translatable('Email'), 'email',           1, 1, 'var', '[% Env("CGIHandle") %]?Action=AgentTicketCompose;ResponseID=1;TicketID=[% Data.TicketID | uri %];ArticleID=[% Data.ArticleID | uri %]', 0, '', 'AsPopup OTRSPopup_TicketAction' ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id', 0, 1, 'var', '', 0 ],
#        [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',        'Phone',       'phone',        1, 0, 'var', '', 0 ],
        [ 'UserFax',          'Fax',         'fax',          1, 0, 'var', '', 0 ],
        [ 'UserMobile',       'Mobile',      'mobile',       1, 0, 'var', '', 0 ],
        [ 'UserStreet',       'Street',      'street',       1, 0, 'var', '', 0 ],
        [ 'UserZip',          'Zip',         'zip',          1, 0, 'var', '', 0 ],
        [ 'UserCity',         'City',        'city',         1, 0, 'var', '', 0 ],
        [ 'UserCountry',      'Country',     'country',      1, 0, 'var', '', 0 ],
        [ 'UserComment',      'Comment',     'comments',     1, 0, 'var', '', 0 ],
        [ 'ValidID',          'Valid',       'valid_id',     0, 1, 'int', '', 0 ],

        # Dynamic field example
#        [ 'DynamicField_Name_X', undef, 'Name_X', 0, 0, 'dynamic_field', undef, 0, undef, undef, ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};
</pre><p>
</p></div></div><br class="example-break"><p>
顧客情報をカスタマイズしたい場合は、カラム・ヘッダーを変更するか、あるいは新規ものをOTRSデータベース中のcustomer_userテーブルに加えてください。例として、下記のスクリプトは、room番号用の新規フィールドを加える方法を教えます。
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 116 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD room VARCHAR (250);
Query OK, 1 rows affected (0.01 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:　roomフィールドのcustomer_userテーブルへの追加。</em></span>
</p><p>
次のスクリプトで示されるように、さて、新規カラムを<code class="filename">Kernel/Config.pm</code>中のMAP配列に追加してください。
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
    [...]
    [ 'UserRoom',      'Room',      'room',       0, 1, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:roomフィールドのKernel/Config.pmファイルへの追加。</em></span>
</p><p>
担当者インターフェースの顧客リンクによってこの顧客情報をすべて編集することも可能です。
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">注記</h3><p>
        Please note that you may omit <code class="literal">http-link-target</code> and
<code class="literal">link class</code> keys in map array elements, if they are not to
be used. These keys add <code class="literal">target=""</code> and
<code class="literal">class=""</code> attributes to the HTTP link element,
respectively. They are ignored if <code class="literal">http-link</code> is not set.
    </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="multi-customer-ids-db"></a>Customer with Multiple IDs (Company Tickets)</h5></div></div></div><p>
顧客に1つを超える顧客IDを割り当てることは可能です。顧客が他の顧客のチケットへアクセスしなければならないならばこれは役立ちます。（例えば、スーパーバイザはアシスタントのチケットを見たい。）顧客が他の顧客のチケットへアクセスできるならば、OTRSの会社チケット機能が使われます。会社チケットは、顧客パネル中の「会社チケット」リンクによってアクセスすることができます。
</p><p>
会社チケットを使用するために、顧客にとってアクセス可能であるべきIDを備えた新規カラムをOTRSデータベース中のcustomer_userテーブルに加えなければなりません(下記のスクリプトを参照)。
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 124 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD customer_ids VARCHAR (250);
Query OK, 1 rows affected (0.02 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
    <span class="emphasis"><em>スクリプト: customer_idsフィールドのcustomer_userテーブルへの追加。</em></span>
</p><p>
スクリプトの中で下に示されるように、新規カラムを<code class="filename">Kernel/Config.pm</code>中のMAP配列に加えなければなりません。
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
    [...]
    [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト: UserCustomerIDsフィールドの Kernel/Config.pmファイル への追加。</em></span>
</p><p>
ここで、多数の顧客IDのための新規カラムは、顧客管理のためのセクションの中で担当者・インターフェース経由で編集することができます。
</p><p>
To ensure that one customer can access the tickets of other customers, add
the IDs of these other users into the new field for the multiple customer
IDs. Each ID has to be separated by a semicolon (see Example below).
</p><div class="example"><a name="company-tickets-db"></a><p class="title"><b>例4.8 Using Company Tickets with a DB Backend</b></p><div class="example-contents"><p>
顧客A、BおよびCはあなたのシステムに存在します。また、Aは顧客パネルからBとCのチケットにアクセスしたい。BとCは他のユーザのチケットにアクセスするべきではありません。
</p><p>
このセットアップを実現するためには、上に記述されるような<code class="filename">Kernel/Config.pm</code>中のcustomer_userテーブルおよびMappingを変更してください。次に、担当者インターフェースあるいは管理者ページの顧客リンクから、顧客Aのための設定をロードしてください。設定が表示される場合、CustomerIDsのためのフィールドへ値「B;C;」を追加して下さい。
</p></div></div><br class="example-break"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-backend-ldap"></a>LDAP</h4></div></div></div><p>
顧客情報を備えたLDAPディレクトリーを持っているならば、下記の例において示されるように、OTRSの顧客バックエンドとしてそれを使用することができます。
</p><div class="example"><a name="ldap-customer-backend"></a><p class="title"><b>例4.9 LDAP顧客バックエンドの構成</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# CustomerUser
# (customer ldap backend and settings)
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'LDAP Data Source',
    Module =&gt; 'Kernel::System::CustomerUser::LDAP',
    Params =&gt; {
        # ldap host
        Host =&gt; 'bay.csuhayward.edu',
        # ldap base dn
        BaseDN =&gt; 'ou=seas,o=csuh',
        # search scope (one|sub)
        SSCOPE =&gt; 'sub',
        # The following is valid but would only be necessary if the
        # anonymous user does NOT have permission to read from the LDAP tree
        UserDN =&gt; '',
        UserPw =&gt; '',
        # in case you want to add always one filter to each ldap query, use
        # this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
        AlwaysFilter =&gt; '',
            # if the charset of your ldap server is iso-8859-1, use this:
#            SourceCharset =&gt; 'iso-8859-1',

            # Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
            Params =&gt; {
                port =&gt; 389,
                timeout =&gt; 120,
                async =&gt; 0,
                version =&gt; 3,
            },
    },
    # customer unique id
    CustomerKey =&gt; 'uid',
    # customer #
    CustomerID =&gt; 'mail',
    CustomerUserListFields =&gt; ['cn', 'mail'],
    CustomerUserSearchFields =&gt; ['uid', 'cn', 'mail'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['mail'],
    CustomerUserNameFields =&gt; ['givenname', 'sn'],
    # show not own tickets in customer panel, CompanyTickets
    CustomerUserExcludePrimaryCustomerID =&gt; 0,
    # add an ldap filter for valid users (expert setting)
#    CustomerUserValidFilter =&gt; '(!(description=locked))',
    # administrator can't change customer preferences
    AdminSetPreferences =&gt; 0,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
    Map =&gt; [
        # note: Login, Email and CustomerID are mandatory!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
        [ 'UserTitle',      'Title',      'title',           1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'givenname',       1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'sn',              1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'uid',             1, 1, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'mail',            1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'mail',            0, 1, 'var', '', 0 ],
#        [ 'UserCustomerIDs', 'CustomerIDs', 'second_customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
        [ 'UserAddress',    'Address',    'postaladdress',   1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'description',     1, 0, 'var', '', 0 ],
    ],
};
</pre><p>
</p></div></div><br class="example-break"><p>
追加の顧客属性（マネージャーの名前、携帯電話番号あるいは部署のような）が、あなたのLDAPディレクトリーに格納されていて、この情報をOTRSに表示したいならば、次のスクリプトの中で示されるように、これらの属性へのエントリーを備えた<code class="filename">Kernel/Config.pm</code>
中のMAP配列をただ拡張してください。
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
    [...]
    [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:新規フィールドのKernel/Config.pmファイルへの追加</em></span>
</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="multi-customer-ids-ldap"></a>Customer with Multiple IDs (Company Tickets)</h5></div></div></div><p>
LDAPバックエンドを使用する場合、顧客にひとつ以上の顧客IDを割り当てることが可能です。会社チケットを使用するために、新規フィールドを顧客によってアクセス可能なIDを含んでいるLDAPディレクトリーに加えなければなりません。
</p><p>
LDAPディレクトリーの新規フィールドが作成されている場合、スクリプトの中で下に示されるように、新規エントリーを<code class="filename">Kernel/Config.pm</code>中のMAP配列に加えなければなりません。
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
    [...]
    [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:　新規フィールドのKernel/Config.pmファイルへのMaping</em></span>
</p><p>
複数の顧客IDのためのフィールドをLDAPディレクトリーで直接編集しなければなりません。OTRSはLDAPから単に読み込むだけで書き込むことはできません。
</p><p>
To ensure access by a customer to the tickets of other customers, add the
customer IDs of the customers whose tickets should be accessed to the new
field in your LDAP directory. Each ID has to be separated by a semicolon
(see Example below).
</p><div class="example"><a name="company-tickets-ldap"></a><p class="title"><b>例4.10 LDAPバックエンドを備えた会社チケットの使用</b></p><div class="example-contents"><p>
顧客A、BおよびCはあなたのシステムに存在します。また、Aは顧客パネルからBとCのチケットにアクセスしたい。BとCは他のユーザのチケットにアクセスするべきではありません。
</p><p>
このセットアップを実現するためには、上に記述されるような<code class="filename">Kernel/Config.pm</code>中のLDAPディレクトリーおよびMappingを変更してください。その後、CustomerIDsのためのフィールドへ値「B;
C;」をあなたのLDAPディレクトリーの顧客Aのために追加して下さい。
</p></div></div><br class="example-break"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="multiple-customer-backends"></a>Using More than One Customer Backend with OTRS</h4></div></div></div><p>
If you want to utilize more than one customer data source used with OTRS
(e.g. an LDAP and a database backend), the CustomerUser config parameter
should be expanded with a number, e.g. "CustomerUser1", "CustomerUser2" (see
Example below).
</p><div class="example"><a name="multiple-customer-backend-example"></a><p class="title"><b>例4.11 OTRSでひとつ以上の顧客バックエンドを使用する</b></p><div class="example-contents"><p>
以下は、OTRSでLDAPとデータベース顧客バックエンドの両方を使用する構成例です。
</p><p>
</p><pre class="programlisting">
# 1. Customer user backend: DB
# (customer database backend and settings)
$Self-&gt;{CustomerUser1} = {
    Name =&gt; 'Customer Database',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # if you want to use an external database, add the
        # required settings
#        DSN =&gt; 'DBI:odbc:yourdsn',
#        Type =&gt; 'mssql', # only for ODBC connections
#        DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#        User =&gt; '',
#        Password =&gt; '',
        Table =&gt; 'customer_user',
    },
    # customer unique id
    CustomerKey =&gt; 'login',
    # customer #
    CustomerID =&gt; 'customer_id',
    CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title','first_name','last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # show not own tickets in customer panel, CompanyTickets
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # generate auto logins
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # admin can change customer preferences
#    AdminSetPreferences =&gt; 1,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
#    # just a read only source
#    ReadOnly =&gt; 1,
    Map =&gt; [

        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target
        [ 'UserTitle',      'Title',      'title',        1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name',   1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',    1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',        1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',           0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',        1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id',  0, 1, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'phone',        1, 0, 'var', '', 0 ],
        [ 'UserFax',        'Fax',        'fax',          1, 0, 'var', '', 0 ],
        [ 'UserMobile',     'Mobile',     'mobile',       1, 0, 'var', '', 0 ],
        [ 'UserStreet',     'Street',     'street',       1, 0, 'var', '', 0 ],
        [ 'UserZip',        'Zip',        'zip',          1, 0, 'var', '', 0 ],
        [ 'UserCity',       'City',       'city',         1, 0, 'var', '', 0 ],
        [ 'UserCountry',    'Country',    'country',      1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'comments',     1, 0, 'var', '', 0 ],
        [ 'ValidID',        'Valid',      'valid_id',     0, 1, 'int', '', 0 ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};

# 2. Customer user backend: LDAP
# (customer ldap backend and settings)
$Self-&gt;{CustomerUser2} = {
    Name =&gt; 'LDAP Datasource',
    Module =&gt; 'Kernel::System::CustomerUser::LDAP',
    Params =&gt; {
        # ldap host
        Host =&gt; 'bay.csuhayward.edu',
        # ldap base dn
        BaseDN =&gt; 'ou=seas,o=csuh',
        # search scope (one|sub)
        SSCOPE =&gt; 'sub',
        # The following is valid but would only be necessary if the
        # anonymous user does NOT have permission to read from the LDAP tree
        UserDN =&gt; '',
        UserPw =&gt; '',
        # in case you want to add always one filter to each ldap query, use
        # this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
        AlwaysFilter =&gt; '',
        # if the charset of your ldap server is iso-8859-1, use this:
#        SourceCharset =&gt; 'iso-8859-1',

        # Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
        Params =&gt; {
            port =&gt; 389,
            timeout =&gt; 120,
            async =&gt; 0,
            version =&gt; 3,
        },
    },
    # customer unique id
    CustomerKey =&gt; 'uid',
    # customer #
    CustomerID =&gt; 'mail',
    CustomerUserListFields =&gt; ['cn', 'mail'],
    CustomerUserSearchFields =&gt; ['uid', 'cn', 'mail'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['mail'],
    CustomerUserNameFields =&gt; ['givenname', 'sn'],
    # show not own tickets in customer panel, CompanyTickets
    CustomerUserExcludePrimaryCustomerID =&gt; 0,
    # add a ldap filter for valid users (expert setting)
#    CustomerUserValidFilter =&gt; '(!(description=locked))',
    # admin can't change customer preferences
    AdminSetPreferences =&gt; 0,
    Map =&gt; [
        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
        [ 'UserTitle',      'Title',      'title',           1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'givenname',       1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'sn',              1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'uid',             1, 1, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'mail',            1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'mail',            0, 1, 'var', '', 0 ],
#        [ 'UserCustomerIDs', 'CustomerIDs', 'second_customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
        [ 'UserAddress',    'Address',    'postaladdress',   1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'description',     1, 0, 'var', '', 0 ],
    ],
};
</pre><p>
</p></div></div><br class="example-break"><p>
10までの異なる顧客バックエンドを統合することは可能です。全ての顧客情報を見るか編集する(書き込みアクセス権限が可能と仮定して)ためにOTRSの中で顧客管理インターフェースを使用してください。
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="dynamicfield-from-customeruser"></a>Storing CustomerUser Data in Dynamic Fields</h4></div></div></div><p>
        顧客データを直接チケットの動的フィールドに格納することも時には役立つかもしれません。（例えばこのデータで特別な統計を作成するような目的で）
    </p><p>
        チケットが作成される場合、あるいはチケットの顧客が変更される場合、動的フィールド値がセットされます。動的フィールドの値は顧客データから得られます。これはすべてのバックエンドのために働きますが、特にLDAPバックエンドに役立ちます。
    </p><p>
        To activate this optional feature of OTRS, please activate the settings
"Ticket::EventModulePost###950-DynamicFieldFromCustomerUser" and
"DynamicFieldFromCustomerUser::Mapping". The latter setting contains the
configuration of which CustomerUser field entry should be stored in which
ticket dynamic field. The fields must be present in the system and should be
enabled for AgentTicketFreeText, so that they can be set manually. They
mustn't be enabled for AgentTicketPhone, AgentTicketEmail and
AgentTicketCustomer. If they were, they would have precedence over the
automatically set values.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="auth-backends"></a>Backends to Authenticate Agents and Customers</h3></div></div></div><p>
OTRSは、異なるバックエンドに対する、担当者および顧客を認証するオプションを提示します。
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="agent-auth-backends"></a>担当者のための認証バックエンド</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-db"></a>DB(デフォルト)</h5></div></div></div><p>
The backend to authenticate agents which is used by default is the OTRS
database. Agents can be added and edited via the <a class="link" href="administration.html#adminarea-agents" title="担当者">agent management interface</a> in the <a class="link" href="administration.html#adminarea" title="The Administration Area of OTRS">Admin page</a> (see Example below).
</p><div class="example"><a name="configuration-agent-auth-backend-db"></a><p class="title"><b>例4.12 DBバックエンドに対する認証エージェント</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
 $Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::DB';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-ldap"></a>LDAP</h5></div></div></div><p>
LDAPディレクトリが担当者データをすべて保存する場合、OTRSの中のユーザを認証するためにLDAPモジュールを使用することができます(下記の例を参照)。このモジュールはLDAPツリーに対して単に読み取り権限を有しています。それは、<a class="link" href="administration.html#adminarea-agents" title="担当者">担当者管理インターフェース</a>経由で利用者データを編集することができないことを意味します。
</p><div class="example"><a name="configuration-agent-auth-backend-ldap"></a><p class="title"><b>例4.13 LDAPバックエンドに対する認証エージェント</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an LDAP auth. backend.
# (Make sure Net::LDAP is installed!)
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::LDAP';
$Self-&gt;{'AuthModule::LDAP::Host'} = 'ldap.example.com';
$Self-&gt;{'AuthModule::LDAP::BaseDN'} = 'dc=example,dc=com';
$Self-&gt;{'AuthModule::LDAP::UID'} = 'uid';

# Check if the user is allowed to auth in a posixGroup
# (e. g. user needs to be in a group xyz to use otrs)
$Self-&gt;{'AuthModule::LDAP::GroupDN'} = 'cn=otrsallow,ou=posixGroups,dc=example,dc=com';
$Self-&gt;{'AuthModule::LDAP::AccessAttr'} = 'memberUid';
# for ldap posixGroups objectclass (just uid)
#  $Self-&gt;{'AuthModule::LDAP::UserAttr'} = 'UID';
# for non ldap posixGroups objectclass (with full user dn)
#  $Self-&gt;{'AuthModule::LDAP::UserAttr'} = 'DN';

# The following is valid but would only be necessary if the
# anonymous user do NOT have permission to read from the LDAP tree
$Self-&gt;{'AuthModule::LDAP::SearchUserDN'} = '';
$Self-&gt;{'AuthModule::LDAP::SearchUserPw'} = '';

# in case you want to add always one filter to each ldap query, use
# this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
$Self-&gt;{'AuthModule::LDAP::AlwaysFilter'} = '';

# in case you want to add a suffix to each login name, then
# you can use this option. e. g. user just want to use user but
# in your ldap directory exists user@domain.com
#    $Self-&gt;{'AuthModule::LDAP::UserSuffix'} = '@domain.com';

# Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
$Self-&gt;{'AuthModule::LDAP::Params'} = {
    port =&gt; 389,
    timeout =&gt; 120,
    async =&gt; 0,
    version =&gt; 3,
};
</pre><p>
</p></div></div><br class="example-break"><p>
スクリプトの中で下に示される構成パラメータは、ローカルのOTRSデータベースの中へのLDAPディレクトリーからの利用者データを同期させるために使用することができます。これは、LDAPサーバーにリクエストの数を減らし、OTRSでの認証の速度を向上させます。担当者が最初に認証する場合、データ同期は終っています。ローカルのOTRSデータベースへデータを同期することができますが、LDAPディレクトリーは認証のための最後の実体（インスタンス）です、したがって、LDAPツリー内の活性化されていないユーザは認証することができません。アカウント・データがOTRSデータベースに既に保存されている場合さえ。LDAPディレクトリーの担当者データは、OTRSのウェブインターフェース経由で編集することができません。したがって、LDAPツリーにデータを直接管理しなければなりません。
</p><p>
</p><pre class="programlisting">
# AuthModule用にAuthSyncBackend (AuthSyncModule)定義します。
# キーが存在しそれが空ならば、Syncにならないでしょう。
# サンプル値: AuthSyncBackend, AuthSyncBackend2
$Self-&gt;{'AuthModule::UseSyncBackend'} = 'AuthSyncBackend';

# LDAPに対する担当者データ sync
$Self-&gt;{'AuthSyncModule'} = 'Kernel::System::Auth::Sync::LDAP';
$Self-&gt;{'AuthSyncModule::LDAP::Host'} = 'ldap://ldap.example.com/';
$Self-&gt;{'AuthSyncModule::LDAP::BaseDN'} = 'dc=otrs, dc=org';
$Self-&gt;{'AuthSyncModule::LDAP::UID'} = 'uid';
$Self-&gt;{'AuthSyncModule::LDAP::SearchUserDN'} = 'uid=sys, ou=user, dc=otrs, dc=org';
$Self-&gt;{'AuthSyncModule::LDAP::SearchUserPw'} = 'some_pass';
$Self-&gt;{'AuthSyncModule::LDAP::UserSyncMap'} = {
    # DB -&gt; LDAP
    UserFirstname =&gt; 'givenName',
    UserLastname  =&gt; 'sn',
    UserEmail     =&gt; 'mail',
};
[...]

# AuthSyncModule::LDAP::UserSyncInitialGroups
# (最初の担当者のログインの初期の作成後に、rw許可を持つsync followingグループ）
$Self-&gt;{'AuthSyncModule::LDAP::UserSyncInitialGroups'} = [
    'users',
];
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト：OTRSデータベースの中へのLDAPディレクトリーからの利用者データを同期させること。</em></span>
</p><p>
    Alternatively, you can use LDAP groups to determine group memberships or
roles in OTRS. For more information and examples, see
<code class="filename">Kernel/Config/Defaults.pm</code>. Here is an example for
synchronizing from LDAP into OTRS groups.
</p><p>
    </p><pre class="programlisting">
# Attributes needed for group syncs
# (attribute name for group value key)
$Self-&gt;{'AuthSyncModule::LDAP::AccessAttr'} = 'memberUid';
# (select the attribute for type of group content UID/DN for full ldap name)
# $Self-&gt;{'AuthSyncModule::LDAP::UserAttr'} = 'UID';
# $Self-&gt;{'AuthSyncModule::LDAP::UserAttr'} = 'DN';

AuthSyncModule::LDAP::UserSyncGroupsDefinition
# (If "LDAP" was selected for AuthModule and you want to sync LDAP
# groups to otrs groups, define the following.)
$Self-&gt;{'AuthSyncModule::LDAP::UserSyncGroupsDefinition'} = {
    # your ldap group
    'cn=agent,o=otrs' =&gt; {
        # otrs group(s)
        'admin' =&gt; {
            # permission
            rw =&gt; 1,
            ro =&gt; 1,
        },
        'faq' =&gt; {
            rw =&gt; 0,
            ro =&gt; 1,
        },
    },
    'cn=agent2,o=otrs' =&gt; {
        'users' =&gt; {
            rw =&gt; 1,
            ro =&gt; 1,
        },
    }
};
    </pre><p>
</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-httpbasic"></a>担当者のためのHTTPBasicAuth</h5></div></div></div><p>
If you want to implement a "single sign on" solution for all your agents,
you can use HTTP basic authentication (for all your systems) and the
HTTPBasicAuth module for OTRS (see Example below).
</p><div class="example"><a name="configuration-agent-auth-backend-htbasic"></a><p class="title"><b>例4.14 HTTPBasicを使用して、担当者を認証します。</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# これはapache ($ENV{REMOTE_USER})認証バックエンド用のサンプル構成です。
# apache http-basic-authのシングル・サインオンを持ちたければそれを使います。
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::HTTPBasicAuth';

# Note:
#
# このモジュールを使うなら、代替手段として次の構成設定を使うべきです。
#（もしユーザがapache ($ENV{REMOTE_USER})として認証されていないならば）
$Self-&gt;{LoginURL} = 'http://host.example.com/not-authorised-for-otrs.html';
$Self-&gt;{LogoutURL} = 'http://host.example.com/thanks-for-using-otrs.html';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-radius"></a>Radius</h5></div></div></div><p>
The configuration parameters shown in Example below can be used to
authenticate agents against a Radius server.
</p><div class="example"><a name="configuration-agent-auth-backend-radius"></a><p class="title"><b>例4.15 Radiusバックエンドに対する担当者を認証します。</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# これは、radiusサーバに対するauth. agentsへのサンプル構成です。
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::Radius';
$Self-&gt;{'AuthModule::Radius::Host'} = 'radiushost';
$Self-&gt;{'AuthModule::Radius::Password'} = 'radiussecret';
</pre><p>
</p></div></div><br class="example-break"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-auth-backends"></a>Authentication Backends for Customers</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-db"></a>データベース(デフォルト)</h5></div></div></div><p>
The default user authentication backend for customers in OTRS is the OTRS
database. With this backend, all customer data can be edited via the web
interface of OTRS (see Example below).
</p><div class="example"><a name="configuration-customer-auth-backend-db"></a><p class="title"><b>例4.16 DBバックエンドに対する顧客ユーザ認証</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# これはthe otrs dbに対する認証モジュールです。
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::DB';
$Self-&gt;{'Customer::AuthModule::DB::Table'} = 'customer_user';
$Self-&gt;{'Customer::AuthModule::DB::CustomerKey'} = 'login';
$Self-&gt;{'Customer::AuthModule::DB::CustomerPassword'} = 'pw';
#$Self-&gt;{'Customer::AuthModule::DB::DSN'} = "DBI:mysql:database=customerdb;host=customerdbhost";
#$Self-&gt;{'Customer::AuthModule::DB::User'} = "some_user";
#$Self-&gt;{'Customer::AuthModule::DB::Password'} = "some_password";
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-ldap"></a>LDAP</h5></div></div></div><p>
If you have an LDAP directory with all your customer data, you can use the
LDAP module to authenticate your customers to OTRS (see Example
below). Because this module has only read-access to the LDAP backend, it is
not possible to edit the customer data via the OTRS web interface.
</p><div class="example"><a name="configuration-customer-auth-backend-ldap"></a><p class="title"><b>例4.17 LDAPバックエンドに対する顧客ユーザ認証</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an LDAP auth. backend.
# (make sure Net::LDAP is installed!)
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::LDAP';
$Self-&gt;{'Customer::AuthModule::LDAP::Host'} = 'ldap.example.com';
$Self-&gt;{'Customer::AuthModule::LDAP::BaseDN'} = 'dc=example,dc=com';
$Self-&gt;{'Customer::AuthModule::LDAP::UID'} = 'uid';

# Check if the user is allowed to auth in a posixGroup
# (e. g. user needs to be in a group xyz to use otrs)
$Self-&gt;{'Customer::AuthModule::LDAP::GroupDN'} = 'cn=otrsallow,ou=posixGroups,dc=example,dc=com';
$Self-&gt;{'Customer::AuthModule::LDAP::AccessAttr'} = 'memberUid';
# for ldap posixGroups objectclass (just uid)
$Self-&gt;{'Customer::AuthModule::LDAP::UserAttr'} = 'UID';
# for non ldap posixGroups objectclass (full user dn)
#$Self-&gt;{'Customer::AuthModule::LDAP::UserAttr'} = 'DN';

# The following is valid but would only be necessary if the
# anonymous user does NOT have permission to read from the LDAP tree
$Self-&gt;{'Customer::AuthModule::LDAP::SearchUserDN'} = '';
$Self-&gt;{'Customer::AuthModule::LDAP::SearchUserPw'} = '';

# in case you want to add always one filter to each ldap query, use
# this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
$Self-&gt;{'Customer::AuthModule::LDAP::AlwaysFilter'} = '';

# in case you want to add a suffix to each customer login name, then
# you can use this option. e. g. user just want to use user but
# in your ldap directory exists user@domain.com
#$Self-&gt;{'Customer::AuthModule::LDAP::UserSuffix'} = '@domain.com';

# Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
$Self-&gt;{'Customer::AuthModule::LDAP::Params'} = {
    port =&gt; 389,
    timeout =&gt; 120,
    async =&gt; 0,
    version =&gt; 3,
};
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-httpbasic"></a>HTTPBasicAuth for Customers</h5></div></div></div><p>
If you want to implement a "single sign on" solution for all your customer
users, you can use HTTPBasic authentication (for all your systems) and use
the HTTPBasicAuth module with OTRS (no login is needed with OTRS any
more). See Example below.
</p><div class="example"><a name="configuration-customer-auth-backend-htbasic"></a><p class="title"><b>例4.18 HTTPBasicを備えた顧客ユーザ認証</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# apache ($ENV{REMOTE_USER})認証バックエンド用のサンプル構成です。
# apache http-basic-authのシングル・サインオンを
# 持ちたければそれを使います。
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::HTTPBasicAuth';

# ノート:
# このモジュールを使うなら、代替手段として次の構成設定を使うべきです。
# もしユーザがapache ($ENV{REMOTE_USER})として認証されていないならば
$Self-&gt;{CustomerPanelLoginURL} = 'http://host.example.com/not-authorised-for-otrs.html';
$Self-&gt;{CustomerPanelLogoutURL} = 'http://host.example.com/thanks-for-using-otrs.html';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-radius"></a>Radius</h5></div></div></div><p>
The settings shown in Example below can be used to authenticate your
customers against a Radius server.
</p><div class="example"><a name="configuration-customer-auth-backend-radius"></a><p class="title"><b>例4.19 Radiasのバックエンドに対する顧客ユーザ認証</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# これはRaduisサーバへの認証顧客へのサンプル構成です。
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::Auth::Radius';
$Self-&gt;{'Customer::AuthModule::Radius::Host'} = 'radiushost';
$Self-&gt;{'Customer::AuthModule::Radius::Password'} = 'radiussecret';
</pre><p>
</p></div></div><br class="example-break"></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="customer-self-registration"></a>Customizing the Customer Self-Registration</h3></div></div></div><p>
新規顧客(customer.plパネルによってアクセス可能)のための自己登録をカスタマイズすることは可能です。新規の任意または必須フィールド（room番号、アドレスあるいは状態のような）を追加することができます。
</p><p>
次の例は、顧客のroom番号を格納するためには、この場合どのように顧客データベースの中であなたが必須フィールドを指定することができるか示します。
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-tt"></a>Customizing the Web Interface</h4></div></div></div><p>
To display the new field for the room number in the customer.pl web
interface, the .tt file responsible for the layout in this interface has to
be modified. Edit the
<code class="filename">Kernel/Output/HTML/Templates/Standard/CustomerLogin.tt</code>
file, adding the new field around line 130 (see Script below).
</p><p>
</p><pre class="programlisting">
[...]
&lt;div class="NewLine"&gt;
    &lt;label for="Room"&gt;[% Translate("Room{CustomerUser}") | html %]&lt;/label&gt;
    &lt;input title="[% Translate("Room Number") | html %]" name="Room" type="text" id="UserRoom" maxlength="50" /&gt;
&lt;/div&gt;
[...]
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:ウェブインターフェースでの新規フィールドの表示</em></span>
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-mapping"></a>Customer Mapping</h4></div></div></div><p>
次のステップで、顧客マッピングはroom番号への新規エントリーで拡張しなければなりません。変更がアップデート後に失われないことを確実にするためには、<code class="filename">Kernel/Config.pm</code>
に
<code class="filename">Kernel/Config/Defaults.pm</code>からの「CustomerUser」設定を入れてください。スクリプト中で下に示されるように、MAP配列を変更して、新規room番号フィールドを追加してください。
</p><p>
</p><pre class="programlisting">
# CustomerUser
# （顧客データベース・バックエンドと設定）
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'Database Backend',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # 外部データベースを使いたければ、
        # 必須設定を追加する必要があります。
#        DSN =&gt; 'DBI:odbc:yourdsn',
#        Type =&gt; 'mssql', # only for ODBC connections
#        DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#        User =&gt; '',
#        Password =&gt; '',
        Table =&gt; 'customer_user',
    },
    # customer unique id
    CustomerKey =&gt; 'login',
    # customer #
    CustomerID =&gt; 'customer_id',
    CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
#    CustomerUserListFields =&gt; ['login', 'first_name', 'last_name', 'customer_id', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title', 'first_name', 'last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # 顧客パネルで自身のチケットではなく顧客チケットを表示します。
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # 自動ログインを生成します。
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # 管理者は顧客の選択（選好）を変更できます。
#    AdminSetPreferences =&gt; 1,
#    # キャッシュが生存する秒数 - キャッシュ・データベース必須
#    CacheTTL =&gt; 0,
#    # 読み込み専用のソース
#    ReadOnly =&gt; 1,
    Map =&gt; [

        # ノート：ログイン、Eメール、顧客IDは必要です！
        # 変数、フロントエンド、保存場所、表示(1=常時,2=軽度)、必須、
        # 保存タイプ、httpリンク、読み込み専用、httpリンク・ターゲット。
        [ 'UserTitle',      'Title',      'title',       1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name',  1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',   1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',       1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',          0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',       1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id', 0, 1, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'phone',       1, 0, 'var', '', 0 ],
        [ 'UserFax',        'Fax',        'fax',         1, 0, 'var', '', 0 ],
        [ 'UserMobile',     'Mobile',     'mobile',      1, 0, 'var', '', 0 ],
        [ 'UserRoom',       'Room',       'room',        1, 0, 'var', '', 0 ],
        [ 'UserStreet',     'Street',     'street',      1, 0, 'var', '', 0 ],
        [ 'UserZip',        'Zip',        'zip',         1, 0, 'var', '', 0 ],
        [ 'UserCity',       'City',       'city',        1, 0, 'var', '', 0 ],
        [ 'UserCountry',    'Country',    'country',     1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'comments',    1, 0, 'var', '', 0 ],
        [ 'ValidID',        'Valid',      'valid_id',    0, 1, 'int', '', 0 ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト: マッピング配列の変更</em></span>
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-customer-table"></a>Customizing the <code class="literal">customer_user</code> Table in the OTRS DB</h4></div></div></div><p>
最後のステップは、新しいroom番号カラムをOTRSデータベース中customer_userテーブルに追加することです(下記のスクリプトを参照)。このカラムでは、room番号へのエントリーは格納されます。
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 6 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD room VARCHAR (200);
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
<span class="emphasis"><em>スクリプト:新しいカラムをcustomer_userテーブルに追加</em></span>
</p><p>
Now the new field for the room should be displayed in the Customer
Information panel if filled, and in the Customer User administration
screens. Also, new customers should have to insert their room number if they
register a new account.
</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="email-settings.html">戻る</a> </td><td width="20%" align="center"><a accesskey="u" href="administration.html">上に戻る</a></td><td width="40%" align="right"> <a accesskey="n" href="ticket-settings.html">次へ</a></td></tr><tr><td width="40%" align="left" valign="top">Eメール設定 </td><td width="20%" align="center"><a accesskey="h" href="index.html">ホーム</a></td><td width="40%" align="right" valign="top"> チケット設定</td></tr></table></div></body></html>

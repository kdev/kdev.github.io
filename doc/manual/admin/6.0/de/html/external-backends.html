<html><head>
<!-- otrs.github.io -->
<link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="../../../../../documentation.css">
<script src="https://code.jquery.com/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../../../../../documentation.js"></script>
<link rel="icon" type="image/png" sizes="32x32" href="../../../../../../images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../../../../images/favicon-16x16.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script>
$(document).ready(function() {

    // Hint languages to prevent false matches (php for example).
    hljs.configure({
        languages: ['perl', 'javascript', 'xml', 'html', 'css', 'json', 'yaml']
    });

    // programlistings in manuals
    $('pre.programlisting').each(function(i, block) {
        hljs.highlightBlock(block);
    });
    // code snippets in Perl API docs
    $('.pod pre').addClass('perl').each(function(i, block) {
        hljs.highlightBlock(block);
    });
});</script>
<!-- otrs.github.io -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Using External backends</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.1"><link rel="home" href="index.html" title="OTRS 6 - Admin Handbuch"><link rel="up" href="administration.html" title="Kapitel 4. Administration"><link rel="prev" href="email-settings.html" title="E-Mail-Einstellungen"><link rel="next" href="ticket-settings.html" title="Ticket-Einstellungen"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Using External backends</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="email-settings.html">Zurück</a> </td><th width="60%" align="center">Kapitel 4. Administration</th><td width="20%" align="right"> <a accesskey="n" href="ticket-settings.html">Weiter</a></td></tr></table><hr></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a name="external-backends"></a>Using External backends</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="external-backends.html#customer-data">Customer Data</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-user-backend">Customer User Backend</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-backend-db">Datenbank (Standard)</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#multi-customer-ids-db">Kundenbenutzer mit mehreren Kundennummern</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#customer-backend-ldap">LDAP</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#multi-customer-ids-ldap">Kundenbenutzer mit mehreren Kundennummern</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#multiple-customer-backends">Using More than One Customer Backend with OTRS</a></span></dt><dt><span class="section"><a href="external-backends.html#dynamicfield-from-customeruser">Storing CustomerUser Data in Dynamic Fields</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#auth-backends">Backends to Authenticate Agents and Customers</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#agent-auth-backends">Authentifizierungs-Backends für Agenten</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#agent-auth-backend-db">Datenbank (Standard)</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-ldap">LDAP</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-httpbasic">HTTPBasicAuth für Agenten</a></span></dt><dt><span class="section"><a href="external-backends.html#agent-auth-backend-radius">Radius</a></span></dt></dl></dd><dt><span class="section"><a href="external-backends.html#customer-auth-backends">Authentication Backends for Customers</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-auth-backend-db">Datenbank (Standard)</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-ldap">LDAP</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-httpbasic">HTTPBasicAuth for Customers</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-auth-backend-radius">Radius</a></span></dt></dl></dd></dl></dd><dt><span class="section"><a href="external-backends.html#customer-self-registration">Customizing the Customer Self-Registration</a></span></dt><dd><dl><dt><span class="section"><a href="external-backends.html#customer-self-registration-tt">Customizing the Web Interface</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-self-registration-mapping">Customer Mapping</a></span></dt><dt><span class="section"><a href="external-backends.html#customer-self-registration-customer-table">Customizing the <code class="literal">customer_user</code> Table in the OTRS DB</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="customer-data"></a>Customer Data</h3></div></div></div><p>
OTRS ist in der Lage, mit verschiedenen Kundendaten (insbesondere Login,
E-Mail, Telefon) umzugehen. Diese Informationen können im Agenten-Interface
angezeigt und für das Kunden-Interface verwendet werden. Weiterhin werden
die Daten für die Authentifizierung der Kunden am System benötigt.
</p><p>
Die benutzten/angezeigten Kundendaten sind frei konfigurierbar, es gibt
jedoch folgende benötigte Optionen die unbedingt vorhanden sein müssen,
damit OTRS ordnungsgemäß funktioniert:
</p><p>
</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
      Benutzer-Login
    </p></li><li class="listitem"><p>
      E-Mail-Adresse
    </p></li><li class="listitem"><p>
      Benutzer-Kunden-ID
    </p></li></ul></div><p>
</p><p>
Verwenden Sie die folgenden SysConfig-Parameter, wenn Sie die
Kundeninformationen im Agenten-Interface angezeigen wollen.
</p><p>
</p><pre class="programlisting">
    # Ticket::Frontend::CustomerInfo*
    # (show customer info on Compose (Phone and Email), Zoom and
    # Queue view)
    $Self-&gt;{'Ticket::Frontend::CustomerInfoCompose'} = 1;
    $Self-&gt;{'Ticket::Frontend::CustomerInfoZoom'} = 1;
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: SysConfig Konfigurationsparameter.</em></span>
</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="customer-user-backend"></a>Customer User Backend</h3></div></div></div><p>
Es existieren zwei Kundenbenutzer Back-ends, DB und LDAP. Falls Sie bereits
ein Kundenverzeichnis (z. B. SAP, ...) haben, ist es natürlich möglich,
dafür ein eigenes Back-end zu schreiben.
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-backend-db"></a>Datenbank (Standard)</h4></div></div></div><p>
The Example below shows the configuration of a DB customer backend, which
uses customer data stored in the OTRS database.
</p><div class="example"><a name="db-customer-backend"></a><p class="title"><b>Beispiel 4.7. Konfiguration eines Datenbank-Kunden-Backends</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# CustomerUser (customer database backend and settings)
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'Database Datasource',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # if you want to use an external database, add the required settings
#            DSN =&gt; 'DBI:odbc:yourdsn',
#            Type =&gt; 'mssql', # only for ODBC connections
#            DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#            User =&gt; '',
#            Password =&gt; '',
            Table =&gt; 'customer_user',

            # CaseSensitive will control if the SQL statements need LOWER()
            #   function calls to work case insensitively. Setting this to
            #   1 will improve performance dramatically on large databases.
            CaseSensitive =&gt; 0,
        },
# customer unique id
CustomerKey =&gt; 'login',

# customer #
CustomerID =&gt; 'customer_id',
CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title','first_name','last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # show not own tickets in customer panel, CompanyTickets
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # generate auto logins
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # admin can change customer preferences
#    AdminSetPreferences =&gt; 1,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
#    # just a read only source
#    ReadOnly =&gt; 1,
    Map =&gt; [
        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
        [ 'UserTitle',      'Title',      'title',      1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name', 1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',  1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',      1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',         0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',      1, 1, 'var', '', 0 ],
#        [ 'UserEmail',      Translatable('Email'), 'email',           1, 1, 'var', '[% Env("CGIHandle") %]?Action=AgentTicketCompose;ResponseID=1;TicketID=[% Data.TicketID | uri %];ArticleID=[% Data.ArticleID | uri %]', 0, '', 'AsPopup OTRSPopup_TicketAction' ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id', 0, 1, 'var', '', 0 ],
#        [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',        'Phone',       'phone',        1, 0, 'var', '', 0 ],
        [ 'UserFax',          'Fax',         'fax',          1, 0, 'var', '', 0 ],
        [ 'UserMobile',       'Mobile',      'mobile',       1, 0, 'var', '', 0 ],
        [ 'UserStreet',       'Street',      'street',       1, 0, 'var', '', 0 ],
        [ 'UserZip',          'Zip',         'zip',          1, 0, 'var', '', 0 ],
        [ 'UserCity',         'City',        'city',         1, 0, 'var', '', 0 ],
        [ 'UserCountry',      'Country',     'country',      1, 0, 'var', '', 0 ],
        [ 'UserComment',      'Comment',     'comments',     1, 0, 'var', '', 0 ],
        [ 'ValidID',          'Valid',       'valid_id',     0, 1, 'int', '', 0 ],

        # Dynamic field example
#        [ 'DynamicField_Name_X', undef, 'Name_X', 0, 0, 'dynamic_field', undef, 0, undef, undef, ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};
</pre><p>
</p></div></div><br class="example-break"><p>
Falls Sie die Kundendaten anpassen möchten, ändern Sie in der Datenbank die
Tabellenspalten oder fügen Sie weitere hinzu (im folgenden Beispiel wird ein
Feld für die Raumnummer hinzugefügt).
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 116 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD room VARCHAR (250);
Query OK, 1 rows affected (0.01 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Ein Feld zur Tabelle customer_user hinzufügen.</em></span>
</p><p>
Danach fügen Sie Ihre eigenen Spalten dem MAP Array in der Datei
<code class="filename">Kernel/Config.pm</code> hinzu:
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
    [...]
    [ 'UserRoom',      'Room',      'room',       0, 1, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Hinzufügen eines Feldes in Kernel/Config.pm
file.</em></span>
</p><p>
Es ist auch möglich, diese Kundeninformationen über den Kundenlink im
Agent-Interface zu bearbeiten.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Anmerkung</h3><p>
        Please note that you may omit <code class="literal">http-link-target</code> and
<code class="literal">link class</code> keys in map array elements, if they are not to
be used. These keys add <code class="literal">target=""</code> and
<code class="literal">class=""</code> attributes to the HTTP link element,
respectively. They are ignored if <code class="literal">http-link</code> is not set.
    </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="multi-customer-ids-db"></a>Kundenbenutzer mit mehreren Kundennummern</h5></div></div></div><p>
Es ist möglich, einem Kunden mehr als nur eine Kundennummer zuzuweisen. Dies
kann z. B. dann sinnvoll sein, wenn ein Kunde auf Tickets anderer Kunden
zugreifen muss, z. B. der Abteilungsleiter auf die Tickets der Mitarbeiter
seiner Abteilung. Hat ein Kunde Zugriff auf Tickets anderer Kunden,
verwendet man in OTRS das sog. Firmen Ticket Feature. Im Kunden-Interface
können diese Tickets über den "Firmen-Ticket" Link eingesehen werden.
</p><p>
Um Firmen-Tickets zu verwenden, muss die customer_user Tabelle in der OTRS
Datenbank um eine Spalte erweitert werden, in die später die Kundennummern
eingetragen werden, auf die ein Kunde zusätzlich zu den eigenen Tickets
Zugriff haben soll.
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 124 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD customer_ids VARCHAR (250);
Query OK, 1 rows affected (0.02 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
    <span class="emphasis"><em>Skript: Hinzufügen eines Feldes customer_ids zur Tabelle
customer_user.</em></span>
</p><p>
Danach fügen Sie die neue Spalte dem MAP Array in der Datei
<code class="filename">Kernel/Config.pm</code> hinzu.
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
    [...]
    [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Hinzufügen des Feldes UserCustomerIDs zu
Kernel/Config.pm.</em></span>
</p><p>
Die Spalte für die Multi-Kundennummern kann ab nun über das Admin-Interface
bzw. über die Kundenverwaltung gepflegt werden.
</p><p>
To ensure that one customer can access the tickets of other customers, add
the IDs of these other users into the new field for the multiple customer
IDs. Each ID has to be separated by a semicolon (see Example below).
</p><div class="example"><a name="company-tickets-db"></a><p class="title"><b>Beispiel 4.8. Using Company Tickets with a DB Backend</b></p><div class="example-contents"><p>
Angenommen es sind die Kunden A, B und C im System angelegt. A soll mit
Hilfe von Firmen Tickets über das Kunden-Interface Zugriff auf die Tickets
von B und C haben, B und C sollen jedoch jeweils nur ihre eigenen Tickets
einsehen und bearbeiten können.
</p><p>
Um dieses Setup zu realisieren, ändern Sie wie oben beschrieben die
customer_user Tabelle in der OTRS Datenbank und das Mapping
in<code class="filename">Kernel/Config.pm</code>. Anschließend laden Sie über die
Kundenverwaltung die Einstellungen des Kunden A und tragen bei
"Kundennummern" die Werte "B;C;" ein.
</p></div></div><br class="example-break"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-backend-ldap"></a>LDAP</h4></div></div></div><p>
If you have an LDAP directory with your customer data, you can use it as the
customer backend with OTRS, as shown in Example below.
</p><div class="example"><a name="ldap-customer-backend"></a><p class="title"><b>Beispiel 4.9. Konfiguration eines LDAP Kunden-Backends</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# CustomerUser
# (customer ldap backend and settings)
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'LDAP Data Source',
    Module =&gt; 'Kernel::System::CustomerUser::LDAP',
    Params =&gt; {
        # ldap host
        Host =&gt; 'bay.csuhayward.edu',
        # ldap base dn
        BaseDN =&gt; 'ou=seas,o=csuh',
        # search scope (one|sub)
        SSCOPE =&gt; 'sub',
        # The following is valid but would only be necessary if the
        # anonymous user does NOT have permission to read from the LDAP tree
        UserDN =&gt; '',
        UserPw =&gt; '',
        # in case you want to add always one filter to each ldap query, use
        # this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
        AlwaysFilter =&gt; '',
            # if the charset of your ldap server is iso-8859-1, use this:
#            SourceCharset =&gt; 'iso-8859-1',

            # Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
            Params =&gt; {
                port =&gt; 389,
                timeout =&gt; 120,
                async =&gt; 0,
                version =&gt; 3,
            },
    },
    # customer unique id
    CustomerKey =&gt; 'uid',
    # customer #
    CustomerID =&gt; 'mail',
    CustomerUserListFields =&gt; ['cn', 'mail'],
    CustomerUserSearchFields =&gt; ['uid', 'cn', 'mail'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['mail'],
    CustomerUserNameFields =&gt; ['givenname', 'sn'],
    # show not own tickets in customer panel, CompanyTickets
    CustomerUserExcludePrimaryCustomerID =&gt; 0,
    # add an ldap filter for valid users (expert setting)
#    CustomerUserValidFilter =&gt; '(!(description=locked))',
    # administrator can't change customer preferences
    AdminSetPreferences =&gt; 0,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
    Map =&gt; [
        # note: Login, Email and CustomerID are mandatory!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
        [ 'UserTitle',      'Title',      'title',           1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'givenname',       1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'sn',              1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'uid',             1, 1, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'mail',            1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'mail',            0, 1, 'var', '', 0 ],
#        [ 'UserCustomerIDs', 'CustomerIDs', 'second_customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
        [ 'UserAddress',    'Address',    'postaladdress',   1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'description',     1, 0, 'var', '', 0 ],
    ],
};
</pre><p>
</p></div></div><br class="example-break"><p>
Falls Sie in Ihrem LDAP Verzeichnis weitere Informationen zu Ihren Kunden
gespeichert haben und mit OTRS darauf zugreifen möchten, erweitern Sie das
MAP Array in <code class="filename">Kernel/Config.pm</code> bzw. entfernen nicht
gewünschte Einträge.
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target, link class(es)
    [...]
    [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Hinzufügen neuer Felder zu Kernel/Config.pm.</em></span>
</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="multi-customer-ids-ldap"></a>Kundenbenutzer mit mehreren Kundennummern</h5></div></div></div><p>
Um Firmentickets mit einem LDAP zu nutzen, muss ein Feld zum
LDAP-Verzeichnis hinzugefügt werden, welches die IDs enthält, die für einen
Kunden zugänglich sein sollen.
</p><p>
Wenn das neue Feld erstellt wurde, muss es zum MAP Array in
<code class="filename">Kernel/Config.pm</code> hinzugefügt werden.
</p><p>
</p><pre class="programlisting">
    # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
    [...]
    [ 'UserCustomerIDs', 'CustomerIDs', 'customer_ids', 1, 0, 'var', '', 0 ],
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Hinzufügen eines neuen Feldes in
Kernel/Config.pm.</em></span>
</p><p>
Das Feld muss direkt im LDAP-Verzeichnis bearbeitet werden, weil OTRS von
LDAP nur lesen kann, nicht jedoch darauf schreiben.
</p><p>
To ensure access by a customer to the tickets of other customers, add the
customer IDs of the customers whose tickets should be accessed to the new
field in your LDAP directory. Each ID has to be separated by a semicolon
(see Example below).
</p><div class="example"><a name="company-tickets-ldap"></a><p class="title"><b>Beispiel 4.10. Verwendung von Firmentickets mit einem LDAP-Backend</b></p><div class="example-contents"><p>
Angenommen es sind die Kunden A, B und C im System angelegt. A soll mit
Hilfe von Firmen Tickets über das Kunden-Interface Zugriff auf die Tickets
von B und C haben, B und C sollen jedoch jeweils nur ihre eigenen Tickets
einsehen und bearbeiten können.
</p><p>
Um dieses Setup zu realisieren, ändern Sie wie oben beschrieben das LDAP
Verzeichnis und das Mapping in
<code class="filename">Kernel/Config.pm</code>. Anschließend tragen Sie im LDAP
Verzeichnis innerhalb der Einstellungen für den Kunden A für CustomerIDs die
Werte "B;C;" ein.
</p></div></div><br class="example-break"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="multiple-customer-backends"></a>Using More than One Customer Backend with OTRS</h4></div></div></div><p>
If you want to utilize more than one customer data source used with OTRS
(e.g. an LDAP and a database backend), the CustomerUser config parameter
should be expanded with a number, e.g. "CustomerUser1", "CustomerUser2" (see
Example below).
</p><div class="example"><a name="multiple-customer-backend-example"></a><p class="title"><b>Beispiel 4.11. Gleichzeitige Einbindung mehrerer verschiedener Kunden Backends</b></p><div class="example-contents"><p>
In der folgenden KOnfiguration verwendet OTRS gleichzeitig ein Datenbank-
und ein LDAP-Kunden-Backend.
</p><p>
</p><pre class="programlisting">
# 1. Customer user backend: DB
# (customer database backend and settings)
$Self-&gt;{CustomerUser1} = {
    Name =&gt; 'Customer Database',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # if you want to use an external database, add the
        # required settings
#        DSN =&gt; 'DBI:odbc:yourdsn',
#        Type =&gt; 'mssql', # only for ODBC connections
#        DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#        User =&gt; '',
#        Password =&gt; '',
        Table =&gt; 'customer_user',
    },
    # customer unique id
    CustomerKey =&gt; 'login',
    # customer #
    CustomerID =&gt; 'customer_id',
    CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title','first_name','last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # show not own tickets in customer panel, CompanyTickets
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # generate auto logins
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # admin can change customer preferences
#    AdminSetPreferences =&gt; 1,
#    # cache time to live in sec. - cache any database queries
#    CacheTTL =&gt; 0,
#    # just a read only source
#    ReadOnly =&gt; 1,
    Map =&gt; [

        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target
        [ 'UserTitle',      'Title',      'title',        1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name',   1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',    1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',        1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',           0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',        1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id',  0, 1, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'phone',        1, 0, 'var', '', 0 ],
        [ 'UserFax',        'Fax',        'fax',          1, 0, 'var', '', 0 ],
        [ 'UserMobile',     'Mobile',     'mobile',       1, 0, 'var', '', 0 ],
        [ 'UserStreet',     'Street',     'street',       1, 0, 'var', '', 0 ],
        [ 'UserZip',        'Zip',        'zip',          1, 0, 'var', '', 0 ],
        [ 'UserCity',       'City',       'city',         1, 0, 'var', '', 0 ],
        [ 'UserCountry',    'Country',    'country',      1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'comments',     1, 0, 'var', '', 0 ],
        [ 'ValidID',        'Valid',      'valid_id',     0, 1, 'int', '', 0 ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};

# 2. Customer user backend: LDAP
# (customer ldap backend and settings)
$Self-&gt;{CustomerUser2} = {
    Name =&gt; 'LDAP Datasource',
    Module =&gt; 'Kernel::System::CustomerUser::LDAP',
    Params =&gt; {
        # ldap host
        Host =&gt; 'bay.csuhayward.edu',
        # ldap base dn
        BaseDN =&gt; 'ou=seas,o=csuh',
        # search scope (one|sub)
        SSCOPE =&gt; 'sub',
        # The following is valid but would only be necessary if the
        # anonymous user does NOT have permission to read from the LDAP tree
        UserDN =&gt; '',
        UserPw =&gt; '',
        # in case you want to add always one filter to each ldap query, use
        # this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
        AlwaysFilter =&gt; '',
        # if the charset of your ldap server is iso-8859-1, use this:
#        SourceCharset =&gt; 'iso-8859-1',

        # Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
        Params =&gt; {
            port =&gt; 389,
            timeout =&gt; 120,
            async =&gt; 0,
            version =&gt; 3,
        },
    },
    # customer unique id
    CustomerKey =&gt; 'uid',
    # customer #
    CustomerID =&gt; 'mail',
    CustomerUserListFields =&gt; ['cn', 'mail'],
    CustomerUserSearchFields =&gt; ['uid', 'cn', 'mail'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['mail'],
    CustomerUserNameFields =&gt; ['givenname', 'sn'],
    # show not own tickets in customer panel, CompanyTickets
    CustomerUserExcludePrimaryCustomerID =&gt; 0,
    # add a ldap filter for valid users (expert setting)
#    CustomerUserValidFilter =&gt; '(!(description=locked))',
    # admin can't change customer preferences
    AdminSetPreferences =&gt; 0,
    Map =&gt; [
        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly
        [ 'UserTitle',      'Title',      'title',           1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'givenname',       1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'sn',              1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'uid',             1, 1, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'mail',            1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'mail',            0, 1, 'var', '', 0 ],
#        [ 'UserCustomerIDs', 'CustomerIDs', 'second_customer_ids', 1, 0, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'telephonenumber', 1, 0, 'var', '', 0 ],
        [ 'UserAddress',    'Address',    'postaladdress',   1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'description',     1, 0, 'var', '', 0 ],
    ],
};
</pre><p>
</p></div></div><br class="example-break"><p>
Es können bis zu 10 Kunden Back-ends gleichzeitig eingebunden werden. Über
die Kundenverwaltung in OTRS ist der Zugriff auf die verschiedenen Back-ends
möglich.
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="dynamicfield-from-customeruser"></a>Storing CustomerUser Data in Dynamic Fields</h4></div></div></div><p>
        Manchmal kann es von Vorteil sein Kundendaten direkt in einem dynamischen
Feld innerhalb eines Ticket zu speichern, um z.b. spezielle Statistiken zu
erzeugen.
    </p><p>
        The dynamic field values are set when a ticket is created or when the
customer of a ticket is changed.  The values of the dynamic fields are taken
from the customer data.  This works for all backends, but is especially
useful for LDAP-backends.
    </p><p>
        To activate this optional feature of OTRS, please activate the settings
<code class="literal">Ticket::EventModulePost###950-DynamicFieldFromCustomerUser</code>
and <code class="literal">DynamicFieldFromCustomerUser::Mapping</code>. The latter
setting contains the configuration of which <code class="literal">CustomerUser</code>
field entry should be stored in which ticket dynamic field. The fields must
be present in the system and should be enabled for
<code class="literal">AgentTicketFreeText</code>, so that they can be set
manually. They mustn't be enabled for <code class="literal">AgentTicketPhone</code>,
<code class="literal">AgentTicketEmail</code> and
<code class="literal">AgentTicketCustomer</code>. If they were, they would have
precedence over the automatically set values.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="auth-backends"></a>Backends to Authenticate Agents and Customers</h3></div></div></div><p>
OTRS bietet die Möglichkeit Agenten und Kunden über verschiedene Back-ends
zu authentifizieren.
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="agent-auth-backends"></a>Authentifizierungs-Backends für Agenten</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-db"></a>Datenbank (Standard)</h5></div></div></div><p>
The backend to authenticate agents which is used by default is the OTRS
database. Agents can be added and edited via the <a class="link" href="administration.html#adminarea-agents" title="Benutzer">agent management interface</a> in the <a class="link" href="administration.html#adminarea" title="The Administration Area of OTRS">Admin page</a> (see Example below).
</p><div class="example"><a name="configuration-agent-auth-backend-db"></a><p class="title"><b>Beispiel 4.12. Agentenauthentifizierung gegen ein Datenbank-Backend</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
    $Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::DB';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-ldap"></a>LDAP</h5></div></div></div><p>
If an LDAP directory has all your agent data stored, you can use the LDAP
module to authenticate your users in OTRS (see Example below). This module
has only read access to the LDAP tree, which means that you cannot edit your
user data via the <a class="link" href="administration.html#adminarea-agents" title="Benutzer">agent management
interface</a>.
</p><div class="example"><a name="configuration-agent-auth-backend-ldap"></a><p class="title"><b>Beispiel 4.13. Agentenauthentifizierung gegen ein LDAP Backend</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an LDAP auth. backend.
# (Make sure Net::LDAP is installed!)
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::LDAP';
$Self-&gt;{'AuthModule::LDAP::Host'} = 'ldap.example.com';
$Self-&gt;{'AuthModule::LDAP::BaseDN'} = 'dc=example,dc=com';
$Self-&gt;{'AuthModule::LDAP::UID'} = 'uid';

# Check if the user is allowed to auth in a posixGroup
# (e. g. user needs to be in a group xyz to use otrs)
$Self-&gt;{'AuthModule::LDAP::GroupDN'} = 'cn=otrsallow,ou=posixGroups,dc=example,dc=com';
$Self-&gt;{'AuthModule::LDAP::AccessAttr'} = 'memberUid';
# for ldap posixGroups objectclass (just uid)
#  $Self-&gt;{'AuthModule::LDAP::UserAttr'} = 'UID';
# for non ldap posixGroups objectclass (with full user dn)
#  $Self-&gt;{'AuthModule::LDAP::UserAttr'} = 'DN';

# The following is valid but would only be necessary if the
# anonymous user do NOT have permission to read from the LDAP tree
$Self-&gt;{'AuthModule::LDAP::SearchUserDN'} = '';
$Self-&gt;{'AuthModule::LDAP::SearchUserPw'} = '';

# in case you want to add always one filter to each ldap query, use
# this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
$Self-&gt;{'AuthModule::LDAP::AlwaysFilter'} = '';

# in case you want to add a suffix to each login name, then
# you can use this option. e. g. user just want to use user but
# in your ldap directory exists user@domain.com
#    $Self-&gt;{'AuthModule::LDAP::UserSuffix'} = '@domain.com';

# Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
$Self-&gt;{'AuthModule::LDAP::Params'} = {
    port =&gt; 389,
    timeout =&gt; 120,
    async =&gt; 0,
    version =&gt; 3,
};
</pre><p>
</p></div></div><br class="example-break"><p>
Mit den folgenden Konfigurationsparametern können die Benutzerdaten der
Agenten aus dem LDAP in die lokale OTRS Datenbank synchronisiert
werden. Dies reduziert die Zugriffe auf ihr LDAP Verzeichnis, entlastet den
Server mit den LDAP Daten und beschleunigt die Anmeldung an OTRS. Die
Synchronisierung der Daten findet bei der ersten Anmeldung des Agenten
statt, trotz der synchronisierten Daten bleibt ihr LDAP Verzeichnis die
letzte Instanz bei der Anmeldung. D.h. wird ein User im LDAP Verzeichnis
gelöscht oder deaktiviert, klappt die Anmeldung an OTRS nicht. Ebenfalls
müssen die Daten für einen Agenten weiterhin direkt im LDAP Verzeichnis
gepflegt werden.
</p><p>
</p><pre class="programlisting">
# defines AuthSyncBackend (AuthSyncModule) for AuthModule
# if this key exists and is empty, there won't be a sync.
# example values: AuthSyncBackend, AuthSyncBackend2
$Self-&gt;{'AuthModule::UseSyncBackend'} = 'AuthSyncBackend';

# agent data sync against ldap
$Self-&gt;{'AuthSyncModule'} = 'Kernel::System::Auth::Sync::LDAP';
$Self-&gt;{'AuthSyncModule::LDAP::Host'} = 'ldap://ldap.example.com/';
$Self-&gt;{'AuthSyncModule::LDAP::BaseDN'} = 'dc=otrs, dc=org';
$Self-&gt;{'AuthSyncModule::LDAP::UID'} = 'uid';
$Self-&gt;{'AuthSyncModule::LDAP::SearchUserDN'} = 'uid=sys, ou=user, dc=otrs, dc=org';
$Self-&gt;{'AuthSyncModule::LDAP::SearchUserPw'} = 'some_pass';
$Self-&gt;{'AuthSyncModule::LDAP::UserSyncMap'} = {
    # DB -&gt; LDAP
    UserFirstname =&gt; 'givenName',
    UserLastname  =&gt; 'sn',
    UserEmail     =&gt; 'mail',
};
[...]

# AuthSyncModule::LDAP::UserSyncInitialGroups
# (sync following group with rw permission after initial create of first agent
# login)
$Self-&gt;{'AuthSyncModule::LDAP::UserSyncInitialGroups'} = [
    'users',
];
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Synchronisation der Benutzerdaten aus dem LDAP-Verzeichnis
in die OTRS-Datenbank.</em></span>
</p><p>
    Alternatively, you can use LDAP groups to determine group memberships or
roles in OTRS. For more information and examples, see
<code class="filename">Kernel/Config/Defaults.pm</code>. Here is an example for
synchronizing from LDAP into OTRS groups.
</p><p>
    </p><pre class="programlisting">
# Attributes needed for group syncs
# (attribute name for group value key)
$Self-&gt;{'AuthSyncModule::LDAP::AccessAttr'} = 'memberUid';
# (select the attribute for type of group content UID/DN for full ldap name)
# $Self-&gt;{'AuthSyncModule::LDAP::UserAttr'} = 'UID';
# $Self-&gt;{'AuthSyncModule::LDAP::UserAttr'} = 'DN';

AuthSyncModule::LDAP::UserSyncGroupsDefinition
# (If "LDAP" was selected for AuthModule and you want to sync LDAP
# groups to otrs groups, define the following.)
$Self-&gt;{'AuthSyncModule::LDAP::UserSyncGroupsDefinition'} = {
    # your ldap group
    'cn=agent,o=otrs' =&gt; {
        # otrs group(s)
        'admin' =&gt; {
            # permission
            rw =&gt; 1,
            ro =&gt; 1,
        },
        'faq' =&gt; {
            rw =&gt; 0,
            ro =&gt; 1,
        },
    },
    'cn=agent2,o=otrs' =&gt; {
        'users' =&gt; {
            rw =&gt; 1,
            ro =&gt; 1,
        },
    }
};
    </pre><p>
</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-httpbasic"></a>HTTPBasicAuth für Agenten</h5></div></div></div><p>
If you want to implement a "single sign on" solution for all your agents,
you can use HTTP basic authentication (for all your systems) and the
HTTPBasicAuth module for OTRS (see Example below).
</p><div class="example"><a name="configuration-agent-auth-backend-htbasic"></a><p class="title"><b>Beispiel 4.14. Agentenauthentifizierung über HTTPBasic</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an apache ($ENV{REMOTE_USER})
# auth. backend. Use it if you want to have a singe login through
# apache http-basic-auth
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::HTTPBasicAuth';

# Note:
#
# If you use this module, you should use as fallback
# the following configuration settings if the user is not authorized
# apache ($ENV{REMOTE_USER})
$Self-&gt;{LoginURL} = 'http://host.example.com/not-authorised-for-otrs.html';
$Self-&gt;{LogoutURL} = 'http://host.example.com/thanks-for-using-otrs.html';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="agent-auth-backend-radius"></a>Radius</h5></div></div></div><p>
The configuration parameters shown in Example below can be used to
authenticate agents against a Radius server.
</p><div class="example"><a name="configuration-agent-auth-backend-radius"></a><p class="title"><b>Beispiel 4.15. Agentenauthentifizierung gegen ein Radius-Backend</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is example configuration to auth. agents against a radius server
$Self-&gt;{'AuthModule'} = 'Kernel::System::Auth::Radius';
$Self-&gt;{'AuthModule::Radius::Host'} = 'radiushost';
$Self-&gt;{'AuthModule::Radius::Password'} = 'radiussecret';
</pre><p>
</p></div></div><br class="example-break"></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-auth-backends"></a>Authentication Backends for Customers</h4></div></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-db"></a>Datenbank (Standard)</h5></div></div></div><p>
The default user authentication backend for customers in OTRS is the OTRS
database. With this backend, all customer data can be edited via the web
interface of OTRS (see Example below).
</p><div class="example"><a name="configuration-customer-auth-backend-db"></a><p class="title"><b>Beispiel 4.16. Kundenauthentifizierung gegen ein Datenbank-Backend</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is the auth. module against the otrs db
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::DB';
$Self-&gt;{'Customer::AuthModule::DB::Table'} = 'customer_user';
$Self-&gt;{'Customer::AuthModule::DB::CustomerKey'} = 'login';
$Self-&gt;{'Customer::AuthModule::DB::CustomerPassword'} = 'pw';
#$Self-&gt;{'Customer::AuthModule::DB::DSN'} = "DBI:mysql:database=customerdb;host=customerdbhost";
#$Self-&gt;{'Customer::AuthModule::DB::User'} = "some_user";
#$Self-&gt;{'Customer::AuthModule::DB::Password'} = "some_password";
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-ldap"></a>LDAP</h5></div></div></div><p>
If you have an LDAP directory with all your customer data, you can use the
LDAP module to authenticate your customers to OTRS (see Example
below). Because this module has only read-access to the LDAP backend, it is
not possible to edit the customer data via the OTRS web interface.
</p><div class="example"><a name="configuration-customer-auth-backend-ldap"></a><p class="title"><b>Beispiel 4.17. Kundenauthentifizierung gegen ein LDAP Backend</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an LDAP auth. backend.
# (make sure Net::LDAP is installed!)
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::LDAP';
$Self-&gt;{'Customer::AuthModule::LDAP::Host'} = 'ldap.example.com';
$Self-&gt;{'Customer::AuthModule::LDAP::BaseDN'} = 'dc=example,dc=com';
$Self-&gt;{'Customer::AuthModule::LDAP::UID'} = 'uid';

# Check if the user is allowed to auth in a posixGroup
# (e. g. user needs to be in a group xyz to use otrs)
$Self-&gt;{'Customer::AuthModule::LDAP::GroupDN'} = 'cn=otrsallow,ou=posixGroups,dc=example,dc=com';
$Self-&gt;{'Customer::AuthModule::LDAP::AccessAttr'} = 'memberUid';
# for ldap posixGroups objectclass (just uid)
$Self-&gt;{'Customer::AuthModule::LDAP::UserAttr'} = 'UID';
# for non ldap posixGroups objectclass (full user dn)
#$Self-&gt;{'Customer::AuthModule::LDAP::UserAttr'} = 'DN';

# The following is valid but would only be necessary if the
# anonymous user does NOT have permission to read from the LDAP tree
$Self-&gt;{'Customer::AuthModule::LDAP::SearchUserDN'} = '';
$Self-&gt;{'Customer::AuthModule::LDAP::SearchUserPw'} = '';

# in case you want to add always one filter to each ldap query, use
# this option. e. g. AlwaysFilter =&gt; '(mail=*)' or AlwaysFilter =&gt; '(objectclass=user)'
$Self-&gt;{'Customer::AuthModule::LDAP::AlwaysFilter'} = '';

# in case you want to add a suffix to each customer login name, then
# you can use this option. e. g. user just want to use user but
# in your ldap directory exists user@domain.com
#$Self-&gt;{'Customer::AuthModule::LDAP::UserSuffix'} = '@domain.com';

# Net::LDAP new params (if needed - for more info see perldoc Net::LDAP)
$Self-&gt;{'Customer::AuthModule::LDAP::Params'} = {
    port =&gt; 389,
    timeout =&gt; 120,
    async =&gt; 0,
    version =&gt; 3,
};
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-httpbasic"></a>HTTPBasicAuth for Customers</h5></div></div></div><p>
If you want to implement a "single sign on" solution for all your customer
users, you can use HTTPBasic authentication (for all your systems) and use
the HTTPBasicAuth module with OTRS (no login is needed with OTRS any
more). See Example below.
</p><div class="example"><a name="configuration-customer-auth-backend-htbasic"></a><p class="title"><b>Beispiel 4.18. Kundenauthentifizierung über HTTPBasic</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is an example configuration for an apache ($ENV{REMOTE_USER})
# auth. backend. Use it if you want to have a singe login through
# apache http-basic-auth
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::CustomerAuth::HTTPBasicAuth';

# Note:
# If you use this module, you should use the following
# config settings as fallback, if user isn't login through
# apache ($ENV{REMOTE_USER})
$Self-&gt;{CustomerPanelLoginURL} = 'http://host.example.com/not-authorised-for-otrs.html';
$Self-&gt;{CustomerPanelLogoutURL} = 'http://host.example.com/thanks-for-using-otrs.html';
</pre><p>
</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="customer-auth-backend-radius"></a>Radius</h5></div></div></div><p>
The settings shown in Example below can be used to authenticate your
customers against a Radius server.
</p><div class="example"><a name="configuration-customer-auth-backend-radius"></a><p class="title"><b>Beispiel 4.19. Kundenauthentifizierung gegen ein Radius-Backend</b></p><div class="example-contents"><p>
</p><pre class="programlisting">
# This is a example configuration to auth. customer against a radius server
$Self-&gt;{'Customer::AuthModule'} = 'Kernel::System::Auth::Radius';
$Self-&gt;{'Customer::AuthModule::Radius::Host'} = 'radiushost';
$Self-&gt;{'Customer::AuthModule::Radius::Password'} = 'radiussecret';
</pre><p>
</p></div></div><br class="example-break"></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="customer-self-registration"></a>Customizing the Customer Self-Registration</h3></div></div></div><p>
Es ist möglich, die Kunden-Selbstregistrierung für neue Kunden über
"customer.pl" anzupassen. Somit können Sie mehr optionale oder benötigte
Felder (z. B. Adresse, Ort, Telefonnummer) hinzufügen.
</p><p>
In folgenden Beispiel wird ein benötigtes Feld für die Raumnummer
hinzugefügt.
</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-tt"></a>Customizing the Web Interface</h4></div></div></div><p>
To display the new field for the room number in the customer.pl web
interface, the .tt file responsible for the layout in this interface has to
be modified. Edit the
<code class="filename">Kernel/Output/HTML/Templates/Standard/CustomerLogin.tt</code>
file, adding the new field around line 130 (see Script below).
</p><p>
</p><pre class="programlisting">
[...]
&lt;div class="NewLine"&gt;
    &lt;label for="Room"&gt;[% Translate("Room{CustomerUser}") | html %]&lt;/label&gt;
    &lt;input title="[% Translate("Room Number") | html %]" name="Room" type="text" id="UserRoom" maxlength="50" /&gt;
&lt;/div&gt;
[...]
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Anzeigen eines neuen Feldes in der
Weboberfläche.</em></span>
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-mapping"></a>Customer Mapping</h4></div></div></div><p>
Zusätzlich muss das Kunden-Mapping um den Eintrag für die Raumnummer
erweitert werden. Dazu werden zuerst die Einstellungen für "CustomerUser"
aus der Datei <code class="filename">Kernel/Config/Defaults.pm</code> in die Datei
<code class="filename">Kernel/Config.pm</code> übertragen. Anschließend wird das
Kunden-Mapping um das Raumnummer-Feld erweitert.
</p><p>
</p><pre class="programlisting">
# CustomerUser
# (customer database backend and settings)
$Self-&gt;{CustomerUser} = {
    Name =&gt; 'Database Backend',
    Module =&gt; 'Kernel::System::CustomerUser::DB',
    Params =&gt; {
        # if you want to use an external database, add the
        # required settings
#        DSN =&gt; 'DBI:odbc:yourdsn',
#        Type =&gt; 'mssql', # only for ODBC connections
#        DSN =&gt; 'DBI:mysql:database=customerdb;host=customerdbhost',
#        User =&gt; '',
#        Password =&gt; '',
        Table =&gt; 'customer_user',
    },
    # customer unique id
    CustomerKey =&gt; 'login',
    # customer #
    CustomerID =&gt; 'customer_id',
    CustomerValid =&gt; 'valid_id',
    CustomerUserListFields =&gt; ['first_name', 'last_name', 'email'],
#    CustomerUserListFields =&gt; ['login', 'first_name', 'last_name', 'customer_id', 'email'],
    CustomerUserSearchFields =&gt; ['login', 'last_name', 'customer_id'],
    CustomerUserSearchPrefix =&gt; '',
    CustomerUserSearchSuffix =&gt; '*',
    CustomerUserSearchListLimit =&gt; 250,
    CustomerUserPostMasterSearchFields =&gt; ['email'],
    CustomerUserNameFields =&gt; ['title', 'first_name', 'last_name'],
    CustomerUserEmailUniqCheck =&gt; 1,
#    # show not own tickets in customer panel, CompanyTickets
#    CustomerUserExcludePrimaryCustomerID =&gt; 0,
#    # generate auto logins
#    AutoLoginCreation =&gt; 0,
#    AutoLoginCreationPrefix =&gt; 'auto',
#    # admin can change customer preferences
#    AdminSetPreferences =&gt; 1,
#    # cache time to live in sec. - cache database queries
#    CacheTTL =&gt; 0,
#    # just a read only source
#    ReadOnly =&gt; 1,
    Map =&gt; [

        # note: Login, Email and CustomerID needed!
        # var, frontend, storage, shown (1=always,2=lite), required, storage-type, http-link, readonly, http-link-target
        [ 'UserTitle',      'Title',      'title',       1, 0, 'var', '', 0 ],
        [ 'UserFirstname',  'Firstname',  'first_name',  1, 1, 'var', '', 0 ],
        [ 'UserLastname',   'Lastname',   'last_name',   1, 1, 'var', '', 0 ],
        [ 'UserLogin',      'Username',   'login',       1, 1, 'var', '', 0 ],
        [ 'UserPassword',   'Password',   'pw',          0, 0, 'var', '', 0 ],
        [ 'UserEmail',      'Email',      'email',       1, 1, 'var', '', 0 ],
        [ 'UserCustomerID', 'CustomerID', 'customer_id', 0, 1, 'var', '', 0 ],
        [ 'UserPhone',      'Phone',      'phone',       1, 0, 'var', '', 0 ],
        [ 'UserFax',        'Fax',        'fax',         1, 0, 'var', '', 0 ],
        [ 'UserMobile',     'Mobile',     'mobile',      1, 0, 'var', '', 0 ],
        [ 'UserRoom',       'Room',       'room',        1, 0, 'var', '', 0 ],
        [ 'UserStreet',     'Street',     'street',      1, 0, 'var', '', 0 ],
        [ 'UserZip',        'Zip',        'zip',         1, 0, 'var', '', 0 ],
        [ 'UserCity',       'City',       'city',        1, 0, 'var', '', 0 ],
        [ 'UserCountry',    'Country',    'country',     1, 0, 'var', '', 0 ],
        [ 'UserComment',    'Comment',    'comments',    1, 0, 'var', '', 0 ],
        [ 'ValidID',        'Valid',      'valid_id',    0, 1, 'int', '', 0 ],
    ],
    # default selections
    Selections =&gt; {
        UserTitle =&gt; {
            'Mr.' =&gt; 'Mr.',
            'Mrs.' =&gt; 'Mrs.',
        },
    },
};
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Anpassung des MAP-Arrays.</em></span>
</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="customer-self-registration-customer-table"></a>Customizing the <code class="literal">customer_user</code> Table in the OTRS DB</h4></div></div></div><p>
Abschließend muss eine neue Spalte zur "customer_user" Tabelle in der OTRS
Datenbank hinzugefügt werden, in der die Raumnummer gespeichert werden kann.
</p><p>
</p><pre class="screen">
linux:~# mysql -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 6 to server version: 5.0.18-Debian_7-log

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; use otrs;
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; ALTER TABLE customer_user ADD room VARCHAR (200);
Query OK, 3 rows affected (0.01 sec)
Records: 3  Duplicates: 0  Warnings: 0

mysql&gt; quit
Bye
linux:~#
</pre><p>
</p><p>
<span class="emphasis"><em>Skript: Hinzufügen einer neuen Spalte zur Tabelle
customer_user.</em></span>
</p><p>
Now the new field for the room should be displayed in the Customer
Information panel if filled, and in the Customer User administration
screens. Also, new customers should have to insert their room number if they
register a new account.
</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="email-settings.html">Zurück</a> </td><td width="20%" align="center"><a accesskey="u" href="administration.html">Nach oben</a></td><td width="40%" align="right"> <a accesskey="n" href="ticket-settings.html">Weiter</a></td></tr><tr><td width="40%" align="left" valign="top">E-Mail-Einstellungen </td><td width="20%" align="center"><a accesskey="h" href="index.html">Zum Anfang</a></td><td width="40%" align="right" valign="top"> Ticket-Einstellungen</td></tr></table></div></body></html>

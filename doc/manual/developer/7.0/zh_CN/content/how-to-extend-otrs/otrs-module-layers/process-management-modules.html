

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>流程管理 &mdash; OTRS Developer Manual 7.0 文档</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/otrs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../search.html" />
    <link rel="next" title="如何发布你的OTRS扩展" href="../../how-to-publish-otrs-extensions.html" />
    <link rel="prev" title="工单邮箱管理员模块" href="ticket-postmaster-modules.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    
    
    <a href="https://doc.otrs.com/doc" class="icon fa-rocket DocumentationOverview"> OTRS Documentation</a>

    

          
            <a href="../../index.html" class="icon icon-home"> OTRS Developer Manual
          

          
            
            <img src="../../../_static/otrs-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目录</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started.html">入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-it-works.html">OTRS内部 - 如何工作</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../how-to-extend-otrs.html">如何扩展OTRS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../writing-otrs-application.html">编写新的OTRS前端模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writing-new-otrs-frontend-component.html">编写新的OTRS前端组件</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../otrs-module-layers.html">使用OTRS模块层的功能</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="agent-auth.html">服务人员身份验证模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth-sync.html">身份验证同步模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="customer-auth.html">客户身份验证模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="customer-user-preferences.html">客户用户首选项模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="queue-preferences.html">队列首选项模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="service-preferences.html">服务首选项模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="sla-preferences.html">SLA首选项模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">日志模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="outputfilter.html">输出过滤器</a></li>
<li class="toctree-l3"><a class="reference internal" href="stats.html">统计模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="ticketnumber-generator.html">工单编号生成器模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="ticketevent.html">工单事件模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard.html">仪表板模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="notify.html">通知模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="ticket-menu.html">工单菜单模块</a></li>
<li class="toctree-l3"><a class="reference internal" href="gi-transport.html">网络传输</a></li>
<li class="toctree-l3"><a class="reference internal" href="gi-mapping.html">映射</a></li>
<li class="toctree-l3"><a class="reference internal" href="gi-invoker.html">调用程序</a></li>
<li class="toctree-l3"><a class="reference internal" href="gi-operation.html">操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="daemon/daemon-modules.html">OTRS守护进程</a></li>
<li class="toctree-l3"><a class="reference internal" href="daemon/scheduler-task-worker-modules.html">OTRS调度程序</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-overview.html">概览</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-framework.html">动态字段框架</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-interaction.html">动态字段与前端模块交互</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-extend-options.html">如何扩展动态字段</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-new-field.html">创建一个新动态字段</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-extend.html">创建一个动态字段功能扩展</a></li>
<li class="toctree-l3"><a class="reference internal" href="ticket-postmaster-modules.html">工单邮箱管理员模块</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">流程管理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#process-management-modules">流程管理模块</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to-publish-otrs-extensions.html">如何发布你的OTRS扩展</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">文档</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">为OTRS做出贡献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../additional-resources.html">其它资源</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OTRS Developer Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../how-to-extend-otrs.html">如何扩展OTRS</a> &raquo;</li>
        
          <li><a href="../otrs-module-layers.html">使用OTRS模块层的功能</a> &raquo;</li>
        
      <li>流程管理</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OTRS/doc-developer/blob/rel-7_0/content/how-to-extend-otrs/otrs-module-layers/process-management-modules.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="process-management">
<h1>流程管理<a class="headerlink" href="#process-management" title="永久链接至标题">¶</a></h1>
<p>由于OTRS 7流程管理可以使用脚本模块来执行活动（脚本任务）和/或序列流操作（之前称为转换操作）。 这些模块位于 <code class="docutils literal notranslate"><span class="pre">Kernel::System::ProcessManagement::Modules</span></code> 中。</p>
<div class="section" id="process-management-modules">
<h2>流程管理模块<a class="headerlink" href="#process-management-modules" title="永久链接至标题">¶</a></h2>
<p>流程管理模块是用Perl语言编写的脚本，用于执行某些操作或基于流程工单的操作（如设置动态字段或更改队列）。 或者到系统的任何其它部分，比如创建新工单。</p>
<p>默认情况下，模块使用一组键值对将它们用作操作的参数，例如： 要更改流程工单的队列，需要队列或队列ID及其对应的值。</p>
<p>某些脚本可能需要多个简单的键值对作为参数，或者其配置可能需要具有更加用户友好的GUI。 在这种情况下，OTRS提供了一些配置字段类型，如果需要也可以扩展。</p>
<p>当前字段类型：</p>
<dl class="docutils">
<dt>下拉选择框</dt>
<dd>显示包含预定义值的下拉列表框。</dd>
<dt>键-值列表</dt>
<dd>显示简单键值对（文本输入）的列表。 可以添加或删除键值对。</dd>
<dt>多语言富文本</dt>
<dd>显示与系统语言关联的富文本编辑器，还显示语言选择器，以便为选择的特定语言添加富文本字段。</dd>
<dt>收件人</dt>
<dd>显示一个多选字段，其中预先填充了用作电子邮件收件人的服务人员，还显示一个自由输入字段，用于指定要添加到收件人列表中的外部电子邮件地址。</dd>
<dt>富文本</dt>
<dd>显示单个富文本字段。</dd>
</dl>
<div class="section" id="creating-a-new-process-management-module">
<h3>创建新的流程管理模块<a class="headerlink" href="#creating-a-new-process-management-module" title="永久链接至标题">¶</a></h3>
<p>下面是如何创建流程管理模块的示例。 它包括一个部分，其中所有可能的字段都被定义为一个引用。 要创建新模块，只需要一种字段类型，但考虑到按照惯例，用户ID参数用于模拟模块中的所有操作，而不是触发操作的用户。 然后，最好始终包含键值列表字段类型以及任何其它所需字段。</p>
<div class="section" id="process-management-module-code-example">
<h4>流程管理模块代码示例<a class="headerlink" href="#process-management-module-code-example" title="永久链接至标题">¶</a></h4>
<p>以下代码实现了一个虚拟的流程管理模块，可用于脚本任务活动或序列流操作。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>

<span class="k">package</span> <span class="nn">Kernel::System::ProcessManagement::Modules::Test</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">utf8</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">Kernel::System::VariableCheck</span> <span class="sx">qw(:all)</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">parent</span> <span class="sx">qw(Kernel::System::ProcessManagement::Modules::Base)</span><span class="p">;</span>

<span class="k">our</span> <span class="nv">@ObjectDependencies</span> <span class="o">=</span> <span class="p">(</span> <span class="p">);</span>
</pre></div>
</div>
<p>这是可在常见OTRS模块中找到的通用标头。 类/包名称通过 <code class="docutils literal notranslate"><span class="pre">package</span></code> 关键字声明。</p>
<p>在本例中我们继承自 <code class="docutils literal notranslate"><span class="pre">Base</span></code> 类，并设置了对象管理器依赖项。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Type</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># Allocate new hash for object.</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nb">bless</span><span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">$Type</span> <span class="p">);</span>

    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">Description</span> <span class="o">=&gt;</span> <span class="s">&#39;Description for the module.&#39;</span><span class="p">,</span>
        <span class="n">ConfigSets</span>  <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="n">Type</span>        <span class="o">=&gt;</span> <span class="s">&#39;Dropdown&#39;</span><span class="p">,</span>
                <span class="n">Description</span> <span class="o">=&gt;</span> <span class="s">&#39;Description for Dropdown.&#39;</span><span class="p">,</span>
                <span class="n">Mandatory</span>   <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">Config</span>      <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="n">Data</span> <span class="o">=&gt;</span> <span class="p">{</span>
                        <span class="n">Internal1</span> <span class="o">=&gt;</span> <span class="s">&#39;Display 1&#39;</span><span class="p">,</span>
                        <span class="n">Internal2</span> <span class="o">=&gt;</span> <span class="s">&#39;Display 2&#39;</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="n">Name</span>         <span class="o">=&gt;</span> <span class="s">&#39;Test-DropDown&#39;</span><span class="p">,</span>
                    <span class="n">Multiple</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">PossibleNone</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">Sort</span>         <span class="o">=&gt;</span> <span class="s">&#39;AlphanumericValue&#39;</span><span class="p">,</span>
                    <span class="n">Translation</span>  <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="n">Type</span>        <span class="o">=&gt;</span> <span class="s">&#39;KeyValueList&#39;</span><span class="p">,</span>
                <span class="n">Description</span> <span class="o">=&gt;</span> <span class="s">&#39;Description of the Key/Value pairs&#39;</span><span class="p">,</span>
                <span class="n">Defaults</span>    <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="n">Key</span>       <span class="o">=&gt;</span> <span class="s">&#39;Test-Param1&#39;</span><span class="p">,</span>
                        <span class="n">Value</span>     <span class="o">=&gt;</span> <span class="s">&#39;Hello&#39;</span><span class="p">,</span>
                        <span class="n">Mandatory</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="n">Key</span>       <span class="o">=&gt;</span> <span class="s">&#39;Test-Param2&#39;</span><span class="p">,</span>
                        <span class="n">Mandatory</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="n">Key</span>       <span class="o">=&gt;</span> <span class="s">&#39;Test-Param3&#39;</span><span class="p">,</span>
                        <span class="n">Value</span>     <span class="o">=&gt;</span> <span class="s">&#39;World&#39;</span><span class="p">,</span>
                        <span class="n">Mandatory</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">],</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="n">Type</span>        <span class="o">=&gt;</span> <span class="s">&#39;MultiLanguageRichText&#39;</span><span class="p">,</span>
                <span class="n">Description</span> <span class="o">=&gt;</span> <span class="s">&quot;Description for Mutli-Language Rich Text.&quot;</span><span class="p">,</span>
                <span class="n">Defaults</span>    <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="n">Key</span>   <span class="o">=&gt;</span> <span class="s">&#39;en_Subject&#39;</span><span class="p">,</span>
                        <span class="n">Value</span> <span class="o">=&gt;</span> <span class="s">&#39;Hello&#39;</span><span class="p">,</span>
                    <span class="p">},</span>
                    <span class="p">{</span>
                        <span class="n">Key</span>   <span class="o">=&gt;</span> <span class="s">&#39;en_Body&#39;</span><span class="p">,</span>
                        <span class="n">Value</span> <span class="o">=&gt;</span> <span class="s">&#39;World&#39;</span><span class="p">,</span>
                    <span class="p">},</span>

                <span class="p">],</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="n">Type</span>        <span class="o">=&gt;</span> <span class="s">&#39;Recipients&#39;</span><span class="p">,</span>
                <span class="n">Description</span> <span class="o">=&gt;</span> <span class="s">&quot;Description for Recipients.&quot;</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="n">Type</span>        <span class="o">=&gt;</span> <span class="s">&#39;RichText&#39;</span><span class="p">,</span>
                <span class="n">Description</span> <span class="o">=&gt;</span> <span class="s">&quot;Description for Rich Text.&quot;</span><span class="p">,</span>
                <span class="n">Defaults</span>    <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="n">Value</span>     <span class="o">=&gt;</span> <span class="s">&#39;Hello World&#39;</span><span class="p">,</span>
                        <span class="n">Mandatory</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">},</span>
                <span class="p">],</span>
            <span class="p">},</span>
        <span class="p">],</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>构造函数 <code class="docutils literal notranslate"><span class="pre">new()</span></code> 创建一个新的类实例。 配置字段在这里定义，它们在 <code class="docutils literal notranslate"><span class="pre">$Self-&gt;{Config}</span></code> 中设置。</p>
<p>该配置有两个主要条目：</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Description</span></code></dt>
<dd>这用于向管理员解释模块执行的操作和/或其配置注意事项。</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ConfigSets</span></code></dt>
<dd>这只是实际配置字段的容器。</dd>
</dl>
<p>所有配置字段都需要一个定义字段类型的类型，并且它们还可以具有内部描述以用作字段小部件的标题。 如果未定义，则使用默认描述。</p>
<p>每个字段定义其配置参数和功能。 以下是OTRS提供的开箱即用的字段的小参考。</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">Dropdown</span></code></p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Mandatory</span></code></dt>
<dd><p class="first last">用于定义是否必须设置值。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Config</span></code></dt>
<dd><p class="first">保存信息以显示下拉选择框字段。</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Data</span></code></dt>
<dd><p class="first last">简单哈希定义下拉选择框的选项。 键在内部使用，值是用户在屏幕中看到的选项。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Name</span></code></dt>
<dd><p class="first last">参数的名称。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Multiple</span></code></dt>
<dd><p class="first last">定义是否只能选择一个或多个值。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PossibleNone</span></code></dt>
<dd><p class="first last">定义值列表是否提供空值。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Sort</span></code></dt>
<dd><p class="first last">定义在渲染字段时如何对选项进行排序。 可能的值是：<code class="docutils literal notranslate"><span class="pre">AlphanumericValue</span></code>、<code class="docutils literal notranslate"><span class="pre">NumericValue</span></code>、<code class="docutils literal notranslate"><span class="pre">AlphanumericKey</span></code> 和 <code class="docutils literal notranslate"><span class="pre">NumericKey</span></code>。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Translation</span></code>:</dt>
<dd><p class="first last">设置是否应翻译显示的值。</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">KeyValueList</span></code></p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Defaults</span></code></dt>
<dd><p class="first">包含其键值对的默认配置的哈希数组。</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Key</span></code></dt>
<dd><p class="first last">参数的名称。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Value</span></code></dt>
<dd><p class="first last">参数的默认值（可选）。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Mandatory</span></code></dt>
<dd><p class="first last">不能重命名或删除必填参数（可选）。</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">MultiLanguageRichText</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Defaults</span></code></dt>
<dd><p class="first">哈希数组，包含每个语言和字段部分的默认配置。</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Key</span></code></dt>
<dd><p class="first last">它由 <code class="docutils literal notranslate"><span class="pre">en</span></code> 或 <code class="docutils literal notranslate"><span class="pre">es_MX</span></code> 等语言组成，后跟一个 <code class="docutils literal notranslate"><span class="pre">_</span></code> （下划线字符），然后是 <code class="docutils literal notranslate"><span class="pre">Subject</span></code> 或 <code class="docutils literal notranslate"><span class="pre">Body</span></code>，用于字段相应的部分。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Value</span></code></dt>
<dd><p class="first last">字段部分的默认值（可选）。</p>
</dd>
</dl>
</dd>
</dl>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">Recipients</span></code></p>
<blockquote>
<div><p>没有为这种字段提供进一步的配置。</p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">RichText</span></code></p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Defaults</span></code></dt>
<dd><p class="first">保存默认配置字段的哈希数组（仅使用第一个元素）。</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Value</span></code></dt>
<dd><p class="first last">该字段的默认值。</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Mandatory</span></code></dt>
<dd><p class="first last">用于定义是否必须设置值。</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</li>
</ul>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">Run</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># Define a common message to output in case of any error.</span>
    <span class="k">my</span> <span class="nv">$CommonMessage</span> <span class="o">=</span> <span class="s">&quot;Process: $Param{ProcessEntityID} Activity: $Param{ActivityEntityID}&quot;</span><span class="p">;</span>

    <span class="c1"># Add SequenceFlowEntityID to common message if available.</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">SequenceFlowEntityID</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$CommonMessage</span> <span class="o">.=</span> <span class="s">&quot; SequenceFlow: $Param{SequenceFlowEntityID}&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># Add SequenceFlowActionEntityID to common message if available.</span>
    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">SequenceFlowActionEntityID</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$CommonMessage</span> <span class="o">.=</span> <span class="s">&quot; SequenceFlowAction: $Param{SequenceFlowActionEntityID}&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># Check for missing or wrong params.</span>
    <span class="k">my</span> <span class="nv">$Success</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_CheckParams</span><span class="p">(</span>
        <span class="nv">%Param</span><span class="p">,</span>
        <span class="n">CommonMessage</span> <span class="o">=&gt;</span> <span class="nv">$CommonMessage</span><span class="p">,</span>
    <span class="p">);</span>
    <span class="k">return</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$Success</span><span class="p">;</span>

    <span class="c1"># Override UserID if specified as a parameter in the TA config.</span>
    <span class="nv">$Param</span><span class="p">{</span><span class="n">UserID</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_OverrideUserID</span><span class="p">(</span><span class="nv">%Param</span><span class="p">);</span>

    <span class="c1"># Use ticket attributes if needed.</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_ReplaceTicketAttributes</span><span class="p">(</span><span class="nv">%Param</span><span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="n">_ReplaceAdditionalAttributes</span><span class="p">(</span><span class="nv">%Param</span><span class="p">);</span>

    <span class="c1"># Get module configuration.</span>
    <span class="k">my</span> <span class="nv">$ModuleConfig</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">Config</span><span class="p">};</span>

    <span class="c1"># Add module logic here!</span>

    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Run</span></code> 方法是模块的主要部分。 首先设置可以在错误日志或任何其它目的中使用的公共消息。 为了保持一致性，强烈建议如上所述使用它。</p>
<p>下一步是检查是否正确发送了全局参数。</p>
<p>按照惯例，所有模块都应该能够覆盖参数中提供的当前用户ID（如果有的话）。 此传递的用户ID应该在需要它的任何函数调用中使用。</p>
<p>用户定义的属性值可以使用OTRS智能标签来使用当前工单值。 <code class="docutils literal notranslate"><span class="pre">_ReplaceTicketAttributes</span></code> 用于普通文本属性，而 <code class="docutils literal notranslate"><span class="pre">_ReplaceAdditionalAttributes</span></code> 用于富文本。 对于更复杂的参数，可能需要自定义函数来替换此智能标签。</p>
<p>以下是该模块的正确逻辑。</p>
<p>如果一切正常，则必须返回1。</p>
</div>
</div>
<div class="section" id="creating-a-new-process-management-module-configuration-field">
<h3>创建新的流程管理模块配置字段<a class="headerlink" href="#creating-a-new-process-management-module-configuration-field" title="永久链接至标题">¶</a></h3>
<p>以下是如何创建流程管理模块配置字段的示例。 任何流程管理模块在配置后都可以使用该字段。</p>
<div class="section" id="process-management-module-configuration-field-code-example">
<h4>流程管理模块配置字段代码示例<a class="headerlink" href="#process-management-module-configuration-field-code-example" title="永久链接至标题">¶</a></h4>
<p>以下代码实现了一个简单的输入流程管理模块配置字段（test）。 可以通过流程管理模块 <code class="docutils literal notranslate"><span class="pre">ConfigSets</span></code> 设置字段的名称及其默认值。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>

<span class="k">package</span> <span class="nn">Kernel::Output::HTML::ProcessManagement::ModuleConfiguration::Test</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">Kernel::System::VariableCheck</span> <span class="sx">qw(:all)</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::Language</span> <span class="sx">qw(Translatable)</span><span class="p">;</span>

<span class="k">our</span> <span class="nv">@ObjectDependencies</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s">&#39;Kernel::Output::HTML::Layout&#39;</span><span class="p">,</span>
    <span class="s">&#39;Kernel::System::Web::Request&#39;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
<p>这是可在常见OTRS模块中找到的通用标头。 类/包名称通过 <code class="docutils literal notranslate"><span class="pre">package</span></code> 关键字声明。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Type</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># allocate new hash for object</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="p">{</span><span class="nv">%Param</span><span class="p">};</span>
    <span class="nb">bless</span><span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">$Type</span> <span class="p">);</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>构造函数 <code class="docutils literal notranslate"><span class="pre">new</span></code> 创建了一个新的类实例。</p>
<p>每个配置字段都需要实现至少2个主要方法：<code class="docutils literal notranslate"><span class="pre">Render</span></code> 和 <code class="docutils literal notranslate"><span class="pre">GetParams</span></code>。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">Render</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$ConfigSet</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ConfigSet</span><span class="p">}</span> <span class="sr">//</span> <span class="p">{};</span>
    <span class="k">my</span> <span class="nv">$EntityConfig</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">EntityData</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">ConfigTest</span><span class="p">}</span> <span class="sr">//</span> <span class="p">{};</span>

    <span class="k">my</span> <span class="nv">%Data</span><span class="p">;</span>

    <span class="nv">$Data</span><span class="p">{</span><span class="n">Description</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$ConfigSet</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Description</span><span class="p">}</span> <span class="o">||</span> <span class="s">&#39;Config Parameters (Test)&#39;</span><span class="p">;</span>
    <span class="nv">$Data</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$ConfigSet</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="sr">//</span> <span class="s">&#39;Test&#39;</span><span class="p">;</span>
    <span class="nv">$Data</span><span class="p">{</span><span class="n">Value</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$EntityConfig</span><span class="o">-&gt;</span><span class="p">{</span> <span class="nv">$ConfigSet</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="p">}</span> <span class="sr">//</span> <span class="nv">$ConfigSet</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Defaults</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Value</span><span class="p">}</span> <span class="sr">//</span> <span class="s">&#39;&#39;</span><span class="p">;</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="n">Success</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">HTML</span>    <span class="o">=&gt;</span> <span class="nv">$</span><span class="nn">Kernel::</span><span class="nv">OM</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="s">&#39;Kernel::Output::HTML::Layout&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">Output</span><span class="p">(</span>
            <span class="n">TemplateFile</span> <span class="o">=&gt;</span> <span class="s">&#39;ProcessManagement/ModuleConfiguration/Test&#39;</span><span class="p">,</span>
            <span class="n">Data</span>         <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%Data</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">};</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Render</span></code> 方法负责为字段创建所需的HTML。</p>
<p>在此示例中，它首先本地化一些参数，以便更容易地读取和维护。</p>
<p>以下行设置要显示的数据。 如果定义了字段小部件标题 <code class="docutils literal notranslate"><span class="pre">Description</span></code> 则从 <code class="docutils literal notranslate"><span class="pre">ConfigSet</span></code> 收集，否则它使用默认文本。 类似于字段 <code class="docutils literal notranslate"><span class="pre">Name</span></code>，对于 <code class="docutils literal notranslate"><span class="pre">Value</span></code>，它首先检查活动或序列流操作是否已经存储了值，如果没有，它会尝试使用 <code class="docutils literal notranslate"><span class="pre">ConfigSet</span></code> 中的默认值， 否则使用空。</p>
<p>最后，它返回一个结构，其中包含填充了所收集数据的模板中的HTML代码。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">GetParams</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%GetParams</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$Config</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">ConfigSet</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Config</span><span class="p">}</span> <span class="sr">//</span> <span class="s">&#39;Test&#39;</span><span class="p">;</span>

    <span class="nv">$GetParams</span><span class="p">{</span> <span class="nv">$Config</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="p">}</span> <span class="o">=</span> <span class="nv">$</span><span class="nn">Kernel::</span><span class="nv">OM</span><span class="o">-&gt;</span><span class="n">Get</span><span class="p">(</span><span class="s">&#39;Kernel::System::Web::Request&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetParam</span><span class="p">(</span> <span class="n">Param</span> <span class="o">=&gt;</span> <span class="nv">$Config</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Name</span><span class="p">}</span> <span class="p">);</span>

    <span class="k">return</span> <span class="o">\</span><span class="nv">%GetParams</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>对于这个例子，<code class="docutils literal notranslate"><span class="pre">GetParams</span></code> 方法非常简单。 它从 <code class="docutils literal notranslate"><span class="pre">ConfigSet</span></code> 获取字段的名称或使用默认值，并从Web请求中获取值。</p>
</div>
<div class="section" id="process-management-module-configuration-field-template-example">
<h4>流程管理模块配置字段模板示例<a class="headerlink" href="#process-management-module-configuration-field-template-example" title="永久链接至标题">¶</a></h4>
<p>以下代码实现了测试流程管理模块配置字段的基本HTML模板。</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>
</pre></div>
</div>
<p>这是可在常见OTRS模块中找到的通用标头。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;div id=&quot;TestConfig&quot; class=&quot;WidgetSimple Expanded&quot;&gt;
    &lt;div class=&quot;Header&quot;&gt;
        &lt;div class=&quot;WidgetAction Toggle&quot;&gt;
            &lt;a href=&quot;#&quot; title=&quot;[% Translate(&quot;Show or hide the content&quot;) | html %]&quot;&gt;&lt;i class=&quot;fa fa-caret-right&quot;&gt;&lt;/i&gt;&lt;i class=&quot;fa fa-caret-down&quot;&gt;&lt;/i&gt;&lt;/a&gt;
        &lt;/div&gt;
        &lt;h2 for=&quot;Config&quot;&gt;[% Translate(Data.Description) | html %]&lt;/h2&gt;
    &lt;/div&gt;
    &lt;div class=&quot;Content&quot; id=&quot;TestParams&quot;&gt;
        &lt;fieldset class=&quot;TableLike&quot;&gt;
            &lt;label for=&quot;[% Data.Name | html %]&quot;&gt;[% Data.Name | html %]&lt;/label&gt;
            &lt;div class=&quot;Field&quot;&gt;
                &lt;input type=&quot;text&quot; value=&quot;[% Data.Value | html %]&quot; name=&quot;[% Data.Name | html %]&quot; id=&quot;[% Data.Name | html %]&quot; /&gt;
            &lt;/div&gt;
        &lt;/fieldset&gt;
    &lt;/div&gt;
&lt;/div&gt;
</pre></div>
</div>
<p>模板显示一个简单的文本输入元素及其关联的标签。</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          

<script>
// Start Google Analytics Tracking
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-28118796-2', 'auto');
ga('send', 'pageview');
// End Google Analytics Tracking
</script>

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../how-to-publish-otrs-extensions.html" class="btn btn-neutral float-right" title="如何发布你的OTRS扩展" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ticket-postmaster-modules.html" class="btn btn-neutral" title="工单邮箱管理员模块" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2001-2020 OTRS AG, https://otrs.com/

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/translations.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
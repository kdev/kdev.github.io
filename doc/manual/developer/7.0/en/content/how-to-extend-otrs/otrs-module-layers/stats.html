

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stats Module &mdash; OTRS Developer Manual 7.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/otrs.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Ticket Number Generator Modules" href="ticketnumber-generator.html" />
    <link rel="prev" title="Output Filter" href="outputfilter.html" /> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    
    
    <a href="https://doc.otrs.com/doc" class="icon fa-rocket DocumentationOverview"> OTRS Documentation</a>

    

          
            <a href="../../index.html" class="icon icon-home"> OTRS Developer Manual
          

          
            
            <img src="../../../_static/otrs-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../get-started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-it-works.html">OTRS Internals - How it Works</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../how-to-extend-otrs.html">How to Extend OTRS</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../writing-otrs-application.html">Writing A New OTRS Front End Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writing-new-otrs-frontend-component.html">Writing A New OTRS Front End Component</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../otrs-module-layers.html">Using the power of the OTRS module layers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="agent-auth.html">Agent Authentication Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="auth-sync.html">Authentication Synchronization Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="customer-auth.html">Customer Authentication Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="customer-user-preferences.html">Customer User Preferences Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="queue-preferences.html">Queue Preferences Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="service-preferences.html">Service Preferences Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="sla-preferences.html">SLA Preferences Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="log.html">Log Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="outputfilter.html">Output Filter</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Stats Module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-stats">Dynamic Stats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#static-stats">Static Stats</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ticketnumber-generator.html">Ticket Number Generator Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="ticketevent.html">Ticket Event Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="dashboard.html">Dashboard Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="notify.html">Notification Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="ticket-menu.html">Ticket Menu Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="gi-transport.html">Network Transport</a></li>
<li class="toctree-l3"><a class="reference internal" href="gi-mapping.html">Mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="gi-invoker.html">Invoker</a></li>
<li class="toctree-l3"><a class="reference internal" href="gi-operation.html">Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="daemon/daemon-modules.html">OTRS Daemon</a></li>
<li class="toctree-l3"><a class="reference internal" href="daemon/scheduler-task-worker-modules.html">OTRS Scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-framework.html">Dynamic Fields Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-interaction.html">Dynamic Field Interaction With Front End Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-extend-options.html">How To Extend The Dynamic Fields</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-new-field.html">Creating A New Dynamic Field</a></li>
<li class="toctree-l3"><a class="reference internal" href="dynamic-fields/dynamic-fields-extend.html">Creating a Dynamic Field Functionality Extension</a></li>
<li class="toctree-l3"><a class="reference internal" href="ticket-postmaster-modules.html">Ticket Postmaster Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="process-management-modules.html">Process Management</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to-publish-otrs-extensions.html">How to Publish Your OTRS Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing to OTRS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../additional-resources.html">Additional Resources</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OTRS Developer Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../how-to-extend-otrs.html">How to Extend OTRS</a> &raquo;</li>
        
          <li><a href="../otrs-module-layers.html">Using the power of the OTRS module layers</a> &raquo;</li>
        
      <li>Stats Module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/OTRS/doc-developer/blob/rel-7_0/content/how-to-extend-otrs/otrs-module-layers/stats.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stats-module">
<h1>Stats Module<a class="headerlink" href="#stats-module" title="Permalink to this headline">¶</a></h1>
<p>There are two different types of internal stats modules - dynamic and static. This section describes how such stats modules can be developed.</p>
<div class="section" id="dynamic-stats">
<h2>Dynamic Stats<a class="headerlink" href="#dynamic-stats" title="Permalink to this headline">¶</a></h2>
<p>In contrast to static stats modules, dynamic statistics can be configured via the OTRS web interface. In this section a simple statistic module is developed. Each dynamic stats module has to implement these subroutines:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">new</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">GetObjectName</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">GetObjectAttributes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ExportWrapper</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ImportWrapper</span></code></li>
</ul>
<p>Furthermore the module has to implement either <code class="docutils literal notranslate"><span class="pre">GetStatElement</span></code> or <code class="docutils literal notranslate"><span class="pre">GetStatTable</span></code>. And if the header line of the result table should be changed, a sub called <code class="docutils literal notranslate"><span class="pre">GetHeaderLine</span></code> has to be developed.</p>
<div class="section" id="stats-code-example">
<h3>Stats Code Example<a class="headerlink" href="#stats-code-example" title="Permalink to this headline">¶</a></h3>
<p>In this section a sample stats module is shown and each subroutine is explained.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>

<span class="k">package</span> <span class="nn">Kernel::System::Stats::Dynamic::DynamicStatsTemplate</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">Kernel::System::Queue</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::State</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::Ticket</span><span class="p">;</span>
</pre></div>
</div>
<p>This is a common boilerplate that can be found in common OTRS modules. The class/package name is declared via the <code class="docutils literal notranslate"><span class="pre">package</span></code> keyword. Then the needed modules are used via the <code class="docutils literal notranslate"><span class="pre">use</span></code> keyword.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Type</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># allocate new hash for object</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nb">bless</span><span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">$Type</span> <span class="p">);</span>

    <span class="c1"># check needed objects</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Object</span> <span class="p">(</span>
        <span class="sx">qw(DBObject ConfigObject LogObject UserObject TimeObject MainObject EncodeObject)</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$Object</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="nv">$Object</span><span class="p">}</span> <span class="o">||</span> <span class="nb">die</span> <span class="s">&quot;Got no $Object!&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># created needed objects</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span>    <span class="o">=</span> <span class="nn">Kernel::System::Queue</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span>   <span class="o">=</span> <span class="nn">Kernel::System::Ticket</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">StateObject</span><span class="p">}</span>    <span class="o">=</span> <span class="nn">Kernel::System::State</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">new</span></code> is the constructor for this statistic module. It creates a new instance of the class. According to the coding guidelines objects of other classes that are needed in this module have to be created in <code class="docutils literal notranslate"><span class="pre">new</span></code>. In lines 27 to 29 the object of the stats module is created. Lines 31 to 37 check if objects that are needed in this code - either for creating other objects or in this module - are passed. After that the other objects are created.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">GetObjectName</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">return</span> <span class="s">&#39;Sample Statistics&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">GetObjectName</span></code> returns a name for the statistics module. This is the label that is shown in the drop down in the configuration as well as in the list of existing statistics (column <em>object</em>).</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">GetObjectAttributes</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># get state list</span>
    <span class="k">my</span> <span class="nv">%StateList</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">StateObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">StateList</span><span class="p">(</span>
        <span class="n">UserID</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1"># get queue list</span>
    <span class="k">my</span> <span class="nv">%QueueList</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetAllQueues</span><span class="p">();</span>

    <span class="c1"># get current time to fix bug#3830</span>
    <span class="k">my</span> <span class="nv">$TimeStamp</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TimeObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">CurrentTimestamp</span><span class="p">();</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$Date</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="nv">$TimeStamp</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$Today</span> <span class="o">=</span> <span class="nb">sprintf</span> <span class="s">&quot;%s 23:59:59&quot;</span><span class="p">,</span> <span class="nv">$Date</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@ObjectAttributes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span>
            <span class="n">Name</span>             <span class="o">=&gt;</span> <span class="s">&#39;State&#39;</span><span class="p">,</span>
            <span class="n">UseAsXvalue</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsValueSeries</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsRestriction</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Element</span>          <span class="o">=&gt;</span> <span class="s">&#39;StateIDs&#39;</span><span class="p">,</span>
            <span class="n">Block</span>            <span class="o">=&gt;</span> <span class="s">&#39;MultiSelectField&#39;</span><span class="p">,</span>
            <span class="n">Values</span>           <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%StateList</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="n">Name</span>             <span class="o">=&gt;</span> <span class="s">&#39;Created in Queue&#39;</span><span class="p">,</span>
            <span class="n">UseAsXvalue</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsValueSeries</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsRestriction</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Element</span>          <span class="o">=&gt;</span> <span class="s">&#39;CreatedQueueIDs&#39;</span><span class="p">,</span>
            <span class="n">Block</span>            <span class="o">=&gt;</span> <span class="s">&#39;MultiSelectField&#39;</span><span class="p">,</span>
            <span class="n">Translation</span>      <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">Values</span>           <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%QueueList</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="n">Name</span>             <span class="o">=&gt;</span> <span class="s">&#39;Create Time&#39;</span><span class="p">,</span>
            <span class="n">UseAsXvalue</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsValueSeries</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsRestriction</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Element</span>          <span class="o">=&gt;</span> <span class="s">&#39;CreateTime&#39;</span><span class="p">,</span>
            <span class="n">TimePeriodFormat</span> <span class="o">=&gt;</span> <span class="s">&#39;DateInputFormat&#39;</span><span class="p">,</span>    <span class="c1"># &#39;DateInputFormatLong&#39;,</span>
            <span class="n">Block</span>            <span class="o">=&gt;</span> <span class="s">&#39;Time&#39;</span><span class="p">,</span>
            <span class="n">TimeStop</span>         <span class="o">=&gt;</span> <span class="nv">$Today</span><span class="p">,</span>
            <span class="n">Values</span>           <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="n">TimeStart</span> <span class="o">=&gt;</span> <span class="s">&#39;TicketCreateTimeNewerDate&#39;</span><span class="p">,</span>
                <span class="n">TimeStop</span>  <span class="o">=&gt;</span> <span class="s">&#39;TicketCreateTimeOlderDate&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="nv">@ObjectAttributes</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this sample stats module, we want to provide three attributes the user can chose from: a list of queues, a list of states and a time drop down. To get the values shown in the drop down, some operations are needed. In this case <code class="docutils literal notranslate"><span class="pre">StateList</span></code> and <code class="docutils literal notranslate"><span class="pre">GetAllQueues</span></code> are called.</p>
<p>Then the list of attributes is created. Each attribute is defined via a hash reference. You can use these keys:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Name</span></code></dt>
<dd>The label in the web interface.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">UseAsXvalue</span></code></dt>
<dd>This attribute can be used on the x-axis.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">UseAsValueSeries</span></code></dt>
<dd>This attribute can be used on the y-axis.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">UseAsRestriction</span></code></dt>
<dd>This attribute can be used for restrictions.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Element</span></code></dt>
<dd>The HTML field name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Block</span></code></dt>
<dd>The block name in the template file (e.g. <code class="docutils literal notranslate"><span class="pre">&lt;OTRS_HOME&gt;/Kernel/Output/HTML/Standard/AgentStatsEditXaxis.tt</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Values</span></code></dt>
<dd>The values shown in the attribute.</dd>
</dl>
<p>Hint: If you install this sample and you configure a statistic with some queues - lets say ‘queue A’ and ‘queue B’ - then these queues are the only ones that are shown to the user when he starts the statistic. Sometimes a dynamic drop down or multiselect field is needed. In this case, you can set <code class="docutils literal notranslate"><span class="pre">SelectedValues</span></code> in the definition of the attribute:</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="n">Name</span>             <span class="o">=&gt;</span> <span class="s">&#39;Created in Queue&#39;</span><span class="p">,</span>
    <span class="n">UseAsXvalue</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">UseAsValueSeries</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">UseAsRestriction</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">Element</span>          <span class="o">=&gt;</span> <span class="s">&#39;CreatedQueueIDs&#39;</span><span class="p">,</span>
    <span class="n">Block</span>            <span class="o">=&gt;</span> <span class="s">&#39;MultiSelectField&#39;</span><span class="p">,</span>
    <span class="n">Translation</span>      <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">Values</span>           <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%QueueList</span><span class="p">,</span>
    <span class="n">SelectedValues</span>   <span class="o">=&gt;</span> <span class="p">[</span> <span class="nv">@SelectedQueues</span> <span class="p">],</span>
<span class="p">},</span>
</pre></div>
</div>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">GetStatElement</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># search tickets</span>
    <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TicketSearch</span><span class="p">(</span>
        <span class="n">UserID</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">Result</span>     <span class="o">=&gt;</span> <span class="s">&#39;COUNT&#39;</span><span class="p">,</span>
        <span class="n">Permission</span> <span class="o">=&gt;</span> <span class="s">&#39;ro&#39;</span><span class="p">,</span>
        <span class="n">Limit</span>      <span class="o">=&gt;</span> <span class="mi">100_000_000</span><span class="p">,</span>
        <span class="nv">%Param</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">GetStatElement</span></code> gets called for each cell in the result table. So it should be a numeric value. In this sample it does a simple ticket search. The hash <code class="docutils literal notranslate"><span class="pre">%Param</span></code> contains information about the <em>current</em> x-value and the y-value as well as any restrictions. So, for a cell that should count the created tickets for queue <em>Misc</em> with state <em>open</em> the passed parameter hash looks something like this:</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="s">&#39;CreatedQueueIDs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s">&#39;4&#39;</span>
<span class="p">],</span>
<span class="s">&#39;StateIDs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s">&#39;2&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
<p>If the <em>per cell</em> calculation should be avoided, <code class="docutils literal notranslate"><span class="pre">GetStatTable</span></code> is an alternative. <code class="docutils literal notranslate"><span class="pre">GetStatTable</span></code> returns a list of rows, hence an array of array references. This leads to the same result as using <code class="docutils literal notranslate"><span class="pre">GetStatElement</span></code>.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">GetStatTable</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@StatData</span><span class="p">;</span>

    <span class="k">for</span> <span class="k">my</span> <span class="nv">$StateName</span> <span class="p">(</span> <span class="nb">keys</span> <span class="nv">%</span><span class="p">{</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TableStructure</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">@Row</span><span class="p">;</span>
        <span class="k">for</span> <span class="k">my</span> <span class="nv">$Params</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">TableStructure</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$StateName</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">$Tickets</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TicketSearch</span><span class="p">(</span>
                <span class="n">UserID</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">Result</span>     <span class="o">=&gt;</span> <span class="s">&#39;COUNT&#39;</span><span class="p">,</span>
                <span class="n">Permission</span> <span class="o">=&gt;</span> <span class="s">&#39;ro&#39;</span><span class="p">,</span>
                <span class="n">Limit</span>      <span class="o">=&gt;</span> <span class="mi">100_000_000</span><span class="p">,</span>
                <span class="nv">%</span><span class="p">{</span><span class="nv">$Params</span><span class="p">},</span>
            <span class="p">);</span>

            <span class="nb">push</span> <span class="nv">@Row</span><span class="p">,</span> <span class="nv">$Tickets</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nb">push</span> <span class="nv">@StatData</span><span class="p">,</span> <span class="p">[</span> <span class="nv">$StateName</span><span class="p">,</span> <span class="nv">@Row</span> <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">@StatData</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">GetStatTable</span></code> gets all information about the stats query that is needed. The passed parameters contain information about the attributes (<code class="docutils literal notranslate"><span class="pre">Restrictions</span></code>, attributes that are used for x/y-axis) and the table structure. The table structure is a hash reference where the keys are the values of the y-axis and their values are hash references with the parameters used for <code class="docutils literal notranslate"><span class="pre">GetStatElement</span></code> subroutines.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="s">&#39;Restrictions&#39;</span> <span class="o">=&gt;</span> <span class="p">{},</span>
<span class="s">&#39;TableStructure&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s">&#39;closed successful&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">&#39;CreatedQueueIDs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s">&#39;3&#39;</span>
            <span class="p">],</span>
            <span class="s">&#39;StateIDs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s">&#39;2&#39;</span>
            <span class="p">]</span>
        <span class="p">},</span>
    <span class="p">],</span>
    <span class="s">&#39;closed unsuccessful&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">&#39;CreatedQueueIDs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s">&#39;3&#39;</span>
            <span class="p">],</span>
            <span class="s">&#39;StateIDs&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s">&#39;3&#39;</span>
            <span class="p">]</span>
        <span class="p">},</span>
    <span class="p">],</span>
<span class="p">},</span>
<span class="s">&#39;ValueSeries&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">&#39;Block&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;MultiSelectField&#39;</span><span class="p">,</span>
        <span class="s">&#39;Element&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;StateIDs&#39;</span><span class="p">,</span>
        <span class="s">&#39;Name&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;State&#39;</span><span class="p">,</span>
        <span class="s">&#39;SelectedValues&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s">&#39;5&#39;</span><span class="p">,</span>
            <span class="s">&#39;3&#39;</span><span class="p">,</span>
            <span class="s">&#39;2&#39;</span><span class="p">,</span>
            <span class="s">&#39;1&#39;</span><span class="p">,</span>
            <span class="s">&#39;4&#39;</span>
        <span class="p">],</span>
        <span class="s">&#39;Translation&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&#39;Values&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="s">&#39;1&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;new&#39;</span><span class="p">,</span>
            <span class="s">&#39;10&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;closed with workaround&#39;</span><span class="p">,</span>
            <span class="s">&#39;2&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;closed successful&#39;</span><span class="p">,</span>
            <span class="s">&#39;3&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;closed unsuccessful&#39;</span><span class="p">,</span>
            <span class="s">&#39;4&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;open&#39;</span><span class="p">,</span>
            <span class="s">&#39;5&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;removed&#39;</span><span class="p">,</span>
            <span class="s">&#39;6&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;pending reminder&#39;</span><span class="p">,</span>
            <span class="s">&#39;7&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;pending auto close+&#39;</span><span class="p">,</span>
            <span class="s">&#39;8&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;pending auto close-&#39;</span><span class="p">,</span>
            <span class="s">&#39;9&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;merged&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">],</span>
<span class="s">&#39;XValue&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s">&#39;Block&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;MultiSelectField&#39;</span><span class="p">,</span>
    <span class="s">&#39;Element&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;CreatedQueueIDs&#39;</span><span class="p">,</span>
    <span class="s">&#39;Name&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;Created in Queue&#39;</span><span class="p">,</span>
    <span class="s">&#39;SelectedValues&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s">&#39;3&#39;</span><span class="p">,</span>
        <span class="s">&#39;4&#39;</span><span class="p">,</span>
        <span class="s">&#39;1&#39;</span><span class="p">,</span>
        <span class="s">&#39;2&#39;</span>
    <span class="p">],</span>
    <span class="s">&#39;Translation&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">&#39;Values&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s">&#39;1&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;Postmaster&#39;</span><span class="p">,</span>
        <span class="s">&#39;2&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;Raw&#39;</span><span class="p">,</span>
        <span class="s">&#39;3&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;Junk&#39;</span><span class="p">,</span>
        <span class="s">&#39;4&#39;</span> <span class="o">=&gt;</span> <span class="s">&#39;Misc&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sometimes the headers of the table have to be changed. In that case, a subroutine called <code class="docutils literal notranslate"><span class="pre">GetHeaderLine</span></code> has to be implemented. That subroutine has to return an array reference with the column headers as elements. It gets information about the x-values passed.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">GetHeaderLine</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@HeaderLine</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">);</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$SelectedXValue</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">XValue</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">SelectedValues</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nb">push</span> <span class="nv">@HeaderLine</span><span class="p">,</span> <span class="nv">$Param</span><span class="p">{</span><span class="n">XValue</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Values</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$SelectedXValue</span><span class="p">};</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="o">\</span><span class="nv">@HeaderLine</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">ExportWrapper</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># wrap ids to used spelling</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Use</span> <span class="p">(</span><span class="sx">qw(UseAsValueSeries UseAsRestriction UseAsXvalue)</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ELEMENT:</span>
        <span class="k">for</span> <span class="k">my</span> <span class="nv">$Element</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$Param</span><span class="p">{</span><span class="nv">$Use</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">next</span> <span class="n">ELEMENT</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$Element</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">SelectedValues</span><span class="p">};</span>
            <span class="k">my</span> <span class="nv">$ElementName</span> <span class="o">=</span> <span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Element</span><span class="p">};</span>
            <span class="k">my</span> <span class="nv">$Values</span>      <span class="o">=</span> <span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">SelectedValues</span><span class="p">};</span>

            <span class="k">if</span> <span class="p">(</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;QueueIDs&#39;</span> <span class="o">||</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;CreatedQueueIDs&#39;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="n">ID:</span>
                <span class="k">for</span> <span class="k">my</span> <span class="nv">$ID</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$Values</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">next</span> <span class="n">ID</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$ID</span><span class="p">;</span>
                    <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">QueueLookup</span><span class="p">(</span> <span class="n">QueueID</span> <span class="o">=&gt;</span> <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;StateIDs&#39;</span> <span class="o">||</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;CreatedStateIDs&#39;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">my</span> <span class="nv">%StateList</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">StateObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">StateList</span><span class="p">(</span> <span class="n">UserID</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">);</span>
                <span class="n">ID:</span>
                <span class="k">for</span> <span class="k">my</span> <span class="nv">$ID</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$Values</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">next</span> <span class="n">ID</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$ID</span><span class="p">;</span>
                    <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$StateList</span><span class="p">{</span> <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="p">};</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">\</span><span class="nv">%Param</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Configured statistics can be exported into XML format. But as queues with the same queue names can have different IDs on different OTRS instances it would be quite painful to export the IDs (the statistics would calculate the wrong numbers then). So an export wrapper should be written to use the names instead of ids. This should be done for each <em>dimension</em> of the stats module (x-axis, y-axis and restrictions).</p>
<p><code class="docutils literal notranslate"><span class="pre">ImportWrapper</span></code> works the other way around - it converts the name to the ID in the instance the configuration is imported to.</p>
<p>This is a sample export:</p>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>

<span class="nt">&lt;otrs_stats&gt;</span>
<span class="nt">&lt;Cache&gt;</span>0<span class="nt">&lt;/Cache&gt;</span>
<span class="nt">&lt;Description&gt;</span>Sample stats module<span class="nt">&lt;/Description&gt;</span>
<span class="nt">&lt;File&gt;&lt;/File&gt;</span>
<span class="nt">&lt;Format&gt;</span>CSV<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;Format&gt;</span>Print<span class="nt">&lt;/Format&gt;</span>
<span class="nt">&lt;Object&gt;</span>DeveloperManualSample<span class="nt">&lt;/Object&gt;</span>
<span class="nt">&lt;ObjectModule&gt;</span>Kernel::System::Stats::Dynamic::DynamicStatsTemplate<span class="nt">&lt;/ObjectModule&gt;</span>
<span class="nt">&lt;ObjectName&gt;</span>Sample Statistics<span class="nt">&lt;/ObjectName&gt;</span>
<span class="nt">&lt;Permission&gt;</span>stats<span class="nt">&lt;/Permission&gt;</span>
<span class="nt">&lt;StatType&gt;</span>dynamic<span class="nt">&lt;/StatType&gt;</span>
<span class="nt">&lt;SumCol&gt;</span>0<span class="nt">&lt;/SumCol&gt;</span>
<span class="nt">&lt;SumRow&gt;</span>0<span class="nt">&lt;/SumRow&gt;</span>
<span class="nt">&lt;Title&gt;</span>Sample 1<span class="nt">&lt;/Title&gt;</span>
<span class="nt">&lt;UseAsValueSeries</span> <span class="na">Element=</span><span class="s">&quot;StateIDs&quot;</span> <span class="na">Fixed=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>removed<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>closed unsuccessful<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>closed successful<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>new<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>open<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;/UseAsValueSeries&gt;</span>
<span class="nt">&lt;UseAsXvalue</span> <span class="na">Element=</span><span class="s">&quot;CreatedQueueIDs&quot;</span> <span class="na">Fixed=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>Junk<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>Misc<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>Postmaster<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;SelectedValues&gt;</span>Raw<span class="nt">&lt;/SelectedValues&gt;</span>
<span class="nt">&lt;/UseAsXvalue&gt;</span>
<span class="nt">&lt;Valid&gt;</span>1<span class="nt">&lt;/Valid&gt;</span>
<span class="nt">&lt;/otrs_stats&gt;</span>
</pre></div>
</div>
<p>Now, that all subroutines are explained, this is the complete sample stats module.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>

<span class="k">package</span> <span class="nn">Kernel::System::Stats::Dynamic::DynamicStatsTemplate</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">Kernel::System::Queue</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::State</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::Ticket</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Type</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># allocate new hash for object</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nb">bless</span><span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">$Type</span> <span class="p">);</span>

    <span class="c1"># check needed objects</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Object</span> <span class="p">(</span>
        <span class="sx">qw(DBObject ConfigObject LogObject UserObject TimeObject MainObject EncodeObject)</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$Object</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="nv">$Object</span><span class="p">}</span> <span class="o">||</span> <span class="nb">die</span> <span class="s">&quot;Got no $Object!&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># created needed objects</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span>    <span class="o">=</span> <span class="nn">Kernel::System::Queue</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span>   <span class="o">=</span> <span class="nn">Kernel::System::Ticket</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">StateObject</span><span class="p">}</span>    <span class="o">=</span> <span class="nn">Kernel::System::State</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">GetObjectName</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="k">return</span> <span class="s">&#39;Sample Statistics&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">GetObjectAttributes</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># get state list</span>
    <span class="k">my</span> <span class="nv">%StateList</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">StateObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">StateList</span><span class="p">(</span>
        <span class="n">UserID</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1"># get queue list</span>
    <span class="k">my</span> <span class="nv">%QueueList</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetAllQueues</span><span class="p">();</span>

    <span class="c1"># get current time to fix bug#3830</span>
    <span class="k">my</span> <span class="nv">$TimeStamp</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TimeObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">CurrentTimestamp</span><span class="p">();</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$Date</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span> <span class="sr">/\s+/</span><span class="p">,</span> <span class="nv">$TimeStamp</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$Today</span> <span class="o">=</span> <span class="nb">sprintf</span> <span class="s">&quot;%s 23:59:59&quot;</span><span class="p">,</span> <span class="nv">$Date</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">@ObjectAttributes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span>
            <span class="n">Name</span>             <span class="o">=&gt;</span> <span class="s">&#39;State&#39;</span><span class="p">,</span>
            <span class="n">UseAsXvalue</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsValueSeries</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsRestriction</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Element</span>          <span class="o">=&gt;</span> <span class="s">&#39;StateIDs&#39;</span><span class="p">,</span>
            <span class="n">Block</span>            <span class="o">=&gt;</span> <span class="s">&#39;MultiSelectField&#39;</span><span class="p">,</span>
            <span class="n">Values</span>           <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%StateList</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="n">Name</span>             <span class="o">=&gt;</span> <span class="s">&#39;Created in Queue&#39;</span><span class="p">,</span>
            <span class="n">UseAsXvalue</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsValueSeries</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsRestriction</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Element</span>          <span class="o">=&gt;</span> <span class="s">&#39;CreatedQueueIDs&#39;</span><span class="p">,</span>
            <span class="n">Block</span>            <span class="o">=&gt;</span> <span class="s">&#39;MultiSelectField&#39;</span><span class="p">,</span>
            <span class="n">Translation</span>      <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">Values</span>           <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%QueueList</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="n">Name</span>             <span class="o">=&gt;</span> <span class="s">&#39;Create Time&#39;</span><span class="p">,</span>
            <span class="n">UseAsXvalue</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsValueSeries</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">UseAsRestriction</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Element</span>          <span class="o">=&gt;</span> <span class="s">&#39;CreateTime&#39;</span><span class="p">,</span>
            <span class="n">TimePeriodFormat</span> <span class="o">=&gt;</span> <span class="s">&#39;DateInputFormat&#39;</span><span class="p">,</span>    <span class="c1"># &#39;DateInputFormatLong&#39;,</span>
            <span class="n">Block</span>            <span class="o">=&gt;</span> <span class="s">&#39;Time&#39;</span><span class="p">,</span>
            <span class="n">TimeStop</span>         <span class="o">=&gt;</span> <span class="nv">$Today</span><span class="p">,</span>
            <span class="n">Values</span>           <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="n">TimeStart</span> <span class="o">=&gt;</span> <span class="s">&#39;TicketCreateTimeNewerDate&#39;</span><span class="p">,</span>
                <span class="n">TimeStop</span>  <span class="o">=&gt;</span> <span class="s">&#39;TicketCreateTimeOlderDate&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="nv">@ObjectAttributes</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">GetStatElement</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># search tickets</span>
    <span class="k">return</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TicketSearch</span><span class="p">(</span>
        <span class="n">UserID</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">Result</span>     <span class="o">=&gt;</span> <span class="s">&#39;COUNT&#39;</span><span class="p">,</span>
        <span class="n">Permission</span> <span class="o">=&gt;</span> <span class="s">&#39;ro&#39;</span><span class="p">,</span>
        <span class="n">Limit</span>      <span class="o">=&gt;</span> <span class="mi">100_000_000</span><span class="p">,</span>
        <span class="nv">%Param</span><span class="p">,</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">ExportWrapper</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># wrap ids to used spelling</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Use</span> <span class="p">(</span><span class="sx">qw(UseAsValueSeries UseAsRestriction UseAsXvalue)</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ELEMENT:</span>
        <span class="k">for</span> <span class="k">my</span> <span class="nv">$Element</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$Param</span><span class="p">{</span><span class="nv">$Use</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">next</span> <span class="n">ELEMENT</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$Element</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">SelectedValues</span><span class="p">};</span>
            <span class="k">my</span> <span class="nv">$ElementName</span> <span class="o">=</span> <span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Element</span><span class="p">};</span>
            <span class="k">my</span> <span class="nv">$Values</span>      <span class="o">=</span> <span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">SelectedValues</span><span class="p">};</span>

            <span class="k">if</span> <span class="p">(</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;QueueIDs&#39;</span> <span class="o">||</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;CreatedQueueIDs&#39;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="n">ID:</span>
                <span class="k">for</span> <span class="k">my</span> <span class="nv">$ID</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$Values</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">next</span> <span class="n">ID</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$ID</span><span class="p">;</span>
                    <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">QueueLookup</span><span class="p">(</span> <span class="n">QueueID</span> <span class="o">=&gt;</span> <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;StateIDs&#39;</span> <span class="o">||</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;CreatedStateIDs&#39;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">my</span> <span class="nv">%StateList</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">StateObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">StateList</span><span class="p">(</span> <span class="n">UserID</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">);</span>
                <span class="n">ID:</span>
                <span class="k">for</span> <span class="k">my</span> <span class="nv">$ID</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$Values</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">next</span> <span class="n">ID</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$ID</span><span class="p">;</span>
                    <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$StateList</span><span class="p">{</span> <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="p">};</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">\</span><span class="nv">%Param</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">ImportWrapper</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># wrap used spelling to ids</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Use</span> <span class="p">(</span><span class="sx">qw(UseAsValueSeries UseAsRestriction UseAsXvalue)</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ELEMENT:</span>
        <span class="k">for</span> <span class="k">my</span> <span class="nv">$Element</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$Param</span><span class="p">{</span><span class="nv">$Use</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">next</span> <span class="n">ELEMENT</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$Element</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">SelectedValues</span><span class="p">};</span>
            <span class="k">my</span> <span class="nv">$ElementName</span> <span class="o">=</span> <span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Element</span><span class="p">};</span>
            <span class="k">my</span> <span class="nv">$Values</span>      <span class="o">=</span> <span class="nv">$Element</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">SelectedValues</span><span class="p">};</span>

            <span class="k">if</span> <span class="p">(</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;QueueIDs&#39;</span> <span class="o">||</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;CreatedQueueIDs&#39;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="n">ID:</span>
                <span class="k">for</span> <span class="k">my</span> <span class="nv">$ID</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$Values</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">next</span> <span class="n">ID</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$ID</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">QueueLookup</span><span class="p">(</span> <span class="n">Queue</span> <span class="o">=&gt;</span> <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span>
                            <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">QueueLookup</span><span class="p">(</span> <span class="n">Queue</span> <span class="o">=&gt;</span> <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LogObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Log</span><span class="p">(</span>
                            <span class="n">Priority</span> <span class="o">=&gt;</span> <span class="s">&#39;error&#39;</span><span class="p">,</span>
                            <span class="n">Message</span>  <span class="o">=&gt;</span> <span class="s">&quot;Import: Can&#39; find the queue $ID-&gt;{Content}!&quot;</span>
                        <span class="p">);</span>
                        <span class="nv">$ID</span> <span class="o">=</span> <span class="nb">undef</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">elsif</span> <span class="p">(</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;StateIDs&#39;</span> <span class="o">||</span> <span class="nv">$ElementName</span> <span class="ow">eq</span> <span class="s">&#39;CreatedStateIDs&#39;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="n">ID:</span>
                <span class="k">for</span> <span class="k">my</span> <span class="nv">$ID</span> <span class="p">(</span> <span class="nv">@</span><span class="p">{</span><span class="nv">$Values</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">next</span> <span class="n">ID</span> <span class="k">if</span> <span class="o">!</span><span class="nv">$ID</span><span class="p">;</span>

                    <span class="k">my</span> <span class="nv">%State</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">StateObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">StateGet</span><span class="p">(</span>
                        <span class="n">Name</span>  <span class="o">=&gt;</span> <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">},</span>
                        <span class="n">Cache</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span> <span class="nv">$State</span><span class="p">{</span><span class="n">ID</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="nv">$ID</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">Content</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$State</span><span class="p">{</span><span class="n">ID</span><span class="p">};</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span>
                        <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LogObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Log</span><span class="p">(</span>
                            <span class="n">Priority</span> <span class="o">=&gt;</span> <span class="s">&#39;error&#39;</span><span class="p">,</span>
                            <span class="n">Message</span>  <span class="o">=&gt;</span> <span class="s">&quot;Import: Can&#39; find state $ID-&gt;{Content}!&quot;</span>
                        <span class="p">);</span>
                        <span class="nv">$ID</span> <span class="o">=</span> <span class="nb">undef</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">\</span><span class="nv">%Param</span><span class="p">;</span>
<span class="p">}</span>

<span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="stats-configuration-example">
<h3>Stats Configuration Example<a class="headerlink" href="#stats-configuration-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-XML notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="nt">&lt;otrs_config</span> <span class="na">version=</span><span class="s">&quot;1.0&quot;</span> <span class="na">init=</span><span class="s">&quot;Config&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ConfigItem</span> <span class="na">Name=</span><span class="s">&quot;Stats::DynamicObjectRegistration###DynamicStatsTemplate&quot;</span> <span class="na">Required=</span><span class="s">&quot;0&quot;</span> <span class="na">Valid=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Description</span> <span class="na">Translatable=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>Here you can decide if the common stats module may generate stats about the number of default tickets a requester created.<span class="nt">&lt;/Description&gt;</span>
        <span class="nt">&lt;Group&gt;</span>Framework<span class="nt">&lt;/Group&gt;</span>
        <span class="nt">&lt;SubGroup&gt;</span>Core::Stats<span class="nt">&lt;/SubGroup&gt;</span>
        <span class="nt">&lt;Setting&gt;</span>
            <span class="nt">&lt;Hash&gt;</span>
                <span class="nt">&lt;Item</span> <span class="na">Key=</span><span class="s">&quot;Module&quot;</span><span class="nt">&gt;</span>Kernel::System::Stats::Dynamic::DynamicStatsTemplate<span class="nt">&lt;/Item&gt;</span>
            <span class="nt">&lt;/Hash&gt;</span>
        <span class="nt">&lt;/Setting&gt;</span>
    <span class="nt">&lt;/ConfigItem&gt;</span>
<span class="nt">&lt;/otrs_config&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have a lot of cells in the result table and the <code class="docutils literal notranslate"><span class="pre">GetStatElement</span></code> is quite complex, the request can take a long time.</p>
</div>
</div>
</div>
<div class="section" id="static-stats">
<h2>Static Stats<a class="headerlink" href="#static-stats" title="Permalink to this headline">¶</a></h2>
<p>The subsequent paragraphs describe the static stats. Static stats are very easy to create as these modules have to implement only three subroutines.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">new</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Param</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Run</span></code></li>
</ul>
<div class="section" id="static-stats-code-example">
<h3>Static Stats Code Example<a class="headerlink" href="#static-stats-code-example" title="Permalink to this headline">¶</a></h3>
<p>The following paragraphs describe the subroutines needed in a static stats.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Type</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># allocate new hash for object</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="p">{</span><span class="nv">%Param</span><span class="p">};</span>
    <span class="nb">bless</span><span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">$Type</span> <span class="p">);</span>

    <span class="c1"># check all needed objects</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Needed</span> <span class="p">(</span>
        <span class="sx">qw(DBObject ConfigObject LogObject</span>
<span class="sx">        TimeObject MainObject EncodeObject)</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="o">||</span> <span class="nb">die</span> <span class="s">&quot;Got no $Needed&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># create needed objects</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TypeObject</span><span class="p">}</span>   <span class="o">=</span> <span class="nn">Kernel::System::Type</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span> <span class="o">=</span> <span class="nn">Kernel::System::Ticket</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span>  <span class="o">=</span> <span class="nn">Kernel::System::Queue</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">new</span></code> creates a new instance of the static stats class. First it creates a new object and then it checks for the needed objects.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">Param</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%Queues</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetAllQueues</span><span class="p">();</span>
    <span class="k">my</span> <span class="nv">%Types</span>  <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TypeObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TypeList</span><span class="p">(</span>
        <span class="n">Valid</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">my</span> <span class="nv">@Params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span>
            <span class="n">Frontend</span>  <span class="o">=&gt;</span> <span class="s">&#39;Type&#39;</span><span class="p">,</span>
            <span class="n">Name</span>      <span class="o">=&gt;</span> <span class="s">&#39;TypeIDs&#39;</span><span class="p">,</span>
            <span class="n">Multiple</span>  <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Size</span>      <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">Data</span>      <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%Types</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="n">Frontend</span>  <span class="o">=&gt;</span> <span class="s">&#39;Queue&#39;</span><span class="p">,</span>
            <span class="n">Name</span>      <span class="o">=&gt;</span> <span class="s">&#39;QueueIDs&#39;</span><span class="p">,</span>
            <span class="n">Multiple</span>  <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Size</span>      <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">Data</span>      <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%Queues</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="nv">@Params</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Param</span></code> method provides the list of all parameters/attributes that can be selected to create a static stat. It gets some parameters passed: The values for the stats attributes provided in a request, the format of the stats and the name of the object (name of the module).</p>
<p>The parameters/attributes have to be hash references with these key-value pairs:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Frontend</span></code></dt>
<dd>The label in the web interface.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Name</span></code></dt>
<dd>The HTML field name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Data</span></code></dt>
<dd>The values shown in the attribute.</dd>
</dl>
<p>Other parameter for the <code class="docutils literal notranslate"><span class="pre">BuildSelection</span></code> method of the <code class="docutils literal notranslate"><span class="pre">LayoutObject</span></code> can be used, as it is done with <code class="docutils literal notranslate"><span class="pre">Size</span></code> and <code class="docutils literal notranslate"><span class="pre">Multiple</span></code> in this sample module.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="k">sub</span> <span class="nf">Run</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># check needed stuff</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Needed</span> <span class="p">(</span><span class="sx">qw(TypeIDs QueueIDs)</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$Param</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LogObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Log</span><span class="p">(</span>
                <span class="n">Priority</span> <span class="o">=&gt;</span> <span class="s">&#39;error&#39;</span><span class="p">,</span>
                <span class="n">Message</span>  <span class="o">=&gt;</span> <span class="s">&quot;Need $Needed!&quot;</span><span class="p">,</span>
            <span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># set report title</span>
    <span class="k">my</span> <span class="nv">$Title</span> <span class="o">=</span> <span class="s">&#39;Tickets per Queue&#39;</span><span class="p">;</span>

    <span class="c1"># table headlines</span>
    <span class="k">my</span> <span class="nv">@HeadData</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;Ticket Number&#39;</span><span class="p">,</span>
        <span class="s">&#39;Queue&#39;</span><span class="p">,</span>
        <span class="s">&#39;Type&#39;</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">my</span> <span class="nv">@Data</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@TicketIDs</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TicketSearch</span><span class="p">(</span>
        <span class="n">UserID</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">Result</span>     <span class="o">=&gt;</span> <span class="s">&#39;ARRAY&#39;</span><span class="p">,</span>
        <span class="n">Permission</span> <span class="o">=&gt;</span> <span class="s">&#39;ro&#39;</span><span class="p">,</span>
        <span class="nv">%Param</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">for</span> <span class="k">my</span> <span class="nv">$TicketID</span> <span class="p">(</span> <span class="nv">@TicketIDs</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">%Ticket</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TicketGet</span><span class="p">(</span>
            <span class="n">UserID</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">TicketID</span> <span class="o">=&gt;</span> <span class="nv">$TicketID</span><span class="p">,</span>
        <span class="p">);</span>
        <span class="nb">push</span> <span class="nv">@Data</span><span class="p">,</span> <span class="p">[</span> <span class="nv">$Ticket</span><span class="p">{</span><span class="n">TicketNumber</span><span class="p">},</span> <span class="nv">$Ticket</span><span class="p">{</span><span class="n">Queue</span><span class="p">},</span> <span class="nv">$Ticket</span><span class="p">{</span><span class="n">Type</span><span class="p">}</span> <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span> <span class="p">[</span><span class="nv">$Title</span><span class="p">],</span> <span class="p">[</span><span class="nv">@HeadData</span><span class="p">],</span> <span class="nv">@Data</span> <span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Run</span></code> method actually generates the table data for the stats. It gets the attributes for this stats passed. In this sample in <code class="docutils literal notranslate"><span class="pre">%Param</span></code> a key <code class="docutils literal notranslate"><span class="pre">TypeIDs</span></code> and a key <code class="docutils literal notranslate"><span class="pre">QueueIDs</span></code> exist (see attributes in <code class="docutils literal notranslate"><span class="pre">Param</span></code> method) and their values are array references. The returned data consists of three parts: Two array references and an array. In the first array reference the title for the statistic is stored, the second array reference contains the headlines for the columns in the table. And then the data for the table body follow.</p>
<div class="highlight-Perl notranslate"><div class="highlight"><pre><span></span><span class="c1"># --</span>
<span class="c1"># Copyright (C) 2001-2020 OTRS AG, https://otrs.com/</span>
<span class="c1"># --</span>
<span class="c1"># This software comes with ABSOLUTELY NO WARRANTY. For details, see</span>
<span class="c1"># the enclosed file COPYING for license information (GPL). If you</span>
<span class="c1"># did not receive this file, see https://www.gnu.org/licenses/gpl-3.0.txt.</span>
<span class="c1"># --</span>

<span class="k">package</span> <span class="nn">Kernel::System::Stats::Static::StaticStatsTemplate</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="k">use</span> <span class="nn">Kernel::System::Type</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::Ticket</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Kernel::System::Queue</span><span class="p">;</span>

<span class="cm">=head1 NAME</span>

<span class="cm">StaticStatsTemplate.pm - the module that creates the stats about tickets in a queue</span>

<span class="cm">=head1 SYNOPSIS</span>

<span class="cm">All functions</span>

<span class="cm">=head1 PUBLIC INTERFACE</span>

<span class="cm">=over 4</span>

<span class="cm">=cut</span>

<span class="cm">=item new()</span>

<span class="cm">create an object</span>

<span class="cm">    use Kernel::Config;</span>
<span class="cm">    use Kernel::System::Encode;</span>
<span class="cm">    use Kernel::System::Log;</span>
<span class="cm">    use Kernel::System::Main;</span>
<span class="cm">    use Kernel::System::Time;</span>
<span class="cm">    use Kernel::System::DB;</span>
<span class="cm">    use Kernel::System::Stats::Static::StaticStatsTemplate;</span>

<span class="cm">    my $ConfigObject = Kernel::Config-&gt;new();</span>
<span class="cm">    my $EncodeObject = Kernel::System::Encode-&gt;new(</span>
<span class="cm">        ConfigObject =&gt; $ConfigObject,</span>
<span class="cm">    );</span>
<span class="cm">    my $LogObject    = Kernel::System::Log-&gt;new(</span>
<span class="cm">        ConfigObject =&gt; $ConfigObject,</span>
<span class="cm">    );</span>
<span class="cm">    my $MainObject = Kernel::System::Main-&gt;new(</span>
<span class="cm">        ConfigObject =&gt; $ConfigObject,</span>
<span class="cm">        LogObject    =&gt; $LogObject,</span>
<span class="cm">    );</span>
<span class="cm">    my $TimeObject = Kernel::System::Time-&gt;new(</span>
<span class="cm">        ConfigObject =&gt; $ConfigObject,</span>
<span class="cm">        LogObject    =&gt; $LogObject,</span>
<span class="cm">    );</span>
<span class="cm">    my $DBObject = Kernel::System::DB-&gt;new(</span>
<span class="cm">        ConfigObject =&gt; $ConfigObject,</span>
<span class="cm">        LogObject    =&gt; $LogObject,</span>
<span class="cm">        MainObject   =&gt; $MainObject,</span>
<span class="cm">    );</span>
<span class="cm">    my $StatsObject = Kernel::System::Stats::Static::StaticStatsTemplate-&gt;new(</span>
<span class="cm">        ConfigObject =&gt; $ConfigObject,</span>
<span class="cm">        LogObject    =&gt; $LogObject,</span>
<span class="cm">        MainObject   =&gt; $MainObject,</span>
<span class="cm">        TimeObject   =&gt; $TimeObject,</span>
<span class="cm">        DBObject     =&gt; $DBObject,</span>
<span class="cm">        EncodeObject =&gt; $EncodeObject,</span>
<span class="cm">    );</span>

<span class="cm">=cut</span>

<span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Type</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># allocate new hash for object</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="p">{</span><span class="nv">%Param</span><span class="p">};</span>
    <span class="nb">bless</span><span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">$Type</span> <span class="p">);</span>

    <span class="c1"># check all needed objects</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Needed</span> <span class="p">(</span>
        <span class="sx">qw(DBObject ConfigObject LogObject</span>
<span class="sx">        TimeObject MainObject EncodeObject)</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$Param</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="o">||</span> <span class="nb">die</span> <span class="s">&quot;Got no $Needed&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1"># create needed objects</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TypeObject</span><span class="p">}</span>   <span class="o">=</span> <span class="nn">Kernel::System::Type</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span> <span class="o">=</span> <span class="nn">Kernel::System::Ticket</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>
    <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span>  <span class="o">=</span> <span class="nn">Kernel::System::Queue</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span> <span class="nv">%</span><span class="p">{</span><span class="nv">$Self</span><span class="p">}</span> <span class="p">);</span>

    <span class="k">return</span> <span class="nv">$Self</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">=item Param()</span>

<span class="cm">Get all parameters a user can specify.</span>

<span class="cm">    my @Params = $StatsObject-&gt;Param();</span>

<span class="cm">=cut</span>

<span class="k">sub</span> <span class="nf">Param</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$Self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">%Queues</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">QueueObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">GetAllQueues</span><span class="p">();</span>
    <span class="k">my</span> <span class="nv">%Types</span>  <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TypeObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TypeList</span><span class="p">(</span>
        <span class="n">Valid</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">my</span> <span class="nv">@Params</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span>
            <span class="n">Frontend</span>  <span class="o">=&gt;</span> <span class="s">&#39;Type&#39;</span><span class="p">,</span>
            <span class="n">Name</span>      <span class="o">=&gt;</span> <span class="s">&#39;TypeIDs&#39;</span><span class="p">,</span>
            <span class="n">Multiple</span>  <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Size</span>      <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">Data</span>      <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%Types</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="n">Frontend</span>  <span class="o">=&gt;</span> <span class="s">&#39;Queue&#39;</span><span class="p">,</span>
            <span class="n">Name</span>      <span class="o">=&gt;</span> <span class="s">&#39;QueueIDs&#39;</span><span class="p">,</span>
            <span class="n">Multiple</span>  <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">Size</span>      <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">Data</span>      <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">%Queues</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">);</span>

    <span class="k">return</span> <span class="nv">@Params</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">=item Run()</span>

<span class="cm">generate the statistic.</span>

<span class="cm">    my $StatsInfo = $StatsObject-&gt;Run(</span>
<span class="cm">        TypeIDs  =&gt; [</span>
<span class="cm">            1, 2, 4</span>
<span class="cm">        ],</span>
<span class="cm">        QueueIDs =&gt; [</span>
<span class="cm">            3, 4, 6</span>
<span class="cm">        ],</span>
<span class="cm">    );</span>

<span class="cm">=cut</span>

<span class="k">sub</span> <span class="nf">Run</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span> <span class="nv">$Self</span><span class="p">,</span> <span class="nv">%Param</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>

    <span class="c1"># check needed stuff</span>
    <span class="k">for</span> <span class="k">my</span> <span class="nv">$Needed</span> <span class="p">(</span><span class="sx">qw(TypeIDs QueueIDs)</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nv">$Param</span><span class="p">{</span><span class="nv">$Needed</span><span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
            <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">LogObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">Log</span><span class="p">(</span>
                <span class="n">Priority</span> <span class="o">=&gt;</span> <span class="s">&#39;error&#39;</span><span class="p">,</span>
                <span class="n">Message</span>  <span class="o">=&gt;</span> <span class="s">&quot;Need $Needed!&quot;</span><span class="p">,</span>
            <span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># set report title</span>
    <span class="k">my</span> <span class="nv">$Title</span> <span class="o">=</span> <span class="s">&#39;Tickets per Queue&#39;</span><span class="p">;</span>

    <span class="c1"># table headlines</span>
    <span class="k">my</span> <span class="nv">@HeadData</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s">&#39;Ticket Number&#39;</span><span class="p">,</span>
        <span class="s">&#39;Queue&#39;</span><span class="p">,</span>
        <span class="s">&#39;Type&#39;</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">my</span> <span class="nv">@Data</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@TicketIDs</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TicketSearch</span><span class="p">(</span>
        <span class="n">UserID</span>     <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">Result</span>     <span class="o">=&gt;</span> <span class="s">&#39;ARRAY&#39;</span><span class="p">,</span>
        <span class="n">Permission</span> <span class="o">=&gt;</span> <span class="s">&#39;ro&#39;</span><span class="p">,</span>
        <span class="nv">%Param</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="k">for</span> <span class="k">my</span> <span class="nv">$TicketID</span> <span class="p">(</span> <span class="nv">@TicketIDs</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">%Ticket</span> <span class="o">=</span> <span class="nv">$Self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">TicketObject</span><span class="p">}</span><span class="o">-&gt;</span><span class="n">TicketGet</span><span class="p">(</span>
            <span class="n">UserID</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">TicketID</span> <span class="o">=&gt;</span> <span class="nv">$TicketID</span><span class="p">,</span>
        <span class="p">);</span>
        <span class="nb">push</span> <span class="nv">@Data</span><span class="p">,</span> <span class="p">[</span> <span class="nv">$Ticket</span><span class="p">{</span><span class="n">TicketNumber</span><span class="p">},</span> <span class="nv">$Ticket</span><span class="p">{</span><span class="n">Queue</span><span class="p">},</span> <span class="nv">$Ticket</span><span class="p">{</span><span class="n">Type</span><span class="p">}</span> <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="p">(</span> <span class="p">[</span><span class="nv">$Title</span><span class="p">],</span> <span class="p">[</span><span class="nv">@HeadData</span><span class="p">],</span> <span class="nv">@Data</span> <span class="p">);</span>
<span class="p">}</span>

<span class="mi">1</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="static-stats-configuration-example">
<h3>Static Stats Configuration Example<a class="headerlink" href="#static-stats-configuration-example" title="Permalink to this headline">¶</a></h3>
<p>There is no configuration needed. Right after installation, the module is available to create a statistic for this module.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          

<script>
// Start Google Analytics Tracking
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-28118796-2', 'auto');
ga('send', 'pageview');
// End Google Analytics Tracking
</script>

<footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ticketnumber-generator.html" class="btn btn-neutral float-right" title="Ticket Number Generator Modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="outputfilter.html" class="btn btn-neutral" title="Output Filter" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2001-2020 OTRS AG, https://otrs.com/

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>